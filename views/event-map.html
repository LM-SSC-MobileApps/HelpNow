<div ng-controller="EventMapCtrl">
	<h2>Event {{eventID}}</h2>
    <div id="map" style="height: 710px; border: 1px solid #AAA;"></div>
    <div id="slider" style="height: 100px; width: 200px;">
        <span>Selection Radius: </span>
        <input id="overlayRadiusSlider" type="range" min="0" max="100" value="5" step="5" onchange="showValue(this.value)" />
        <span id="range">5 km</span>
        <br />
        <br />
        <input type="checkbox" id="unitsToggle" name="unitsToggle" class="switch" checked="checked" onchange="changeUnits(this.checked)" />
        <label for="unitsToggle">Metric</label>
    </div>
</div>


<script type="text/javascript">
    if (document.getElementById("overlayRadiusSlider").value == 0) {
        document.getElementById("range").innerHTML = 1 + " km";
    }
    document.getElementById("range").innerHTML = document.getElementById("overlayRadiusSlider").value + " km";
    var overlayRadius = document.getElementById("overlayRadiusSlider").value * 1000;
    var radiusRawVal = document.getElementById("overlayRadiusSlider").value;
    var locationOutline;
    var isMetric;

    function showValue(newValue) {
        if (newValue == 0)
            newValue = 1;


        radiusRawVal = newValue;
        if (isMetric) {
            overlayRadius = newValue * 1000 / 0.62137119;
            document.getElementById("range").innerHTML = newValue + " km";
        }
        else {
            overlayRadius = newValue * 1000 * 0.62137119;
            document.getElementById("range").innerHTML = newValue + " mi";
        }
            
        if (locationOutline != undefined)
            locationOutline.setRadius(overlayRadius);
    }

    function changeUnits(isChecked) {
        if (isChecked) {
            document.getElementById("range").innerHTML = radiusRawVal + " km";
            isMetric = true;
            overlayRadius = overlayRadius / 0.62137119;
            if (locationOutline != undefined)
                locationOutline.setRadius(overlayRadius);
        }
        else {
            document.getElementById("range").innerHTML = radiusRawVal + " mi";
            isMetric = false;
            overlayRadius = overlayRadius * 0.62137119;
            if (locationOutline != undefined)
                locationOutline.setRadius(overlayRadius);
        }
    }
</script>

<script type='text/javascript'>

    var testData = {
        max: 8,
        data: [{ lat: 24.6408, lng: 46.7728, count: 3 }, { lat: 23.7301, lng: 90.3065, count: 2 }]
    };

    var baseLayer = L.tileLayer(
      'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',
          maxZoom: 18
      }
    );

    var cfg = {
        // radius should be small ONLY if scaleRadius is true (or small radius is intended)
        // if scaleRadius is false it will be the constant radius used in pixels
        "radius": 200,
        "maxOpacity": .8,
        // scales the radius based on map zoom
        "scaleRadius": false,
        // if set to false the heatmap uses the global maximum for colorization
        // if activated: uses the data maximum within the current map boundaries
        //   (there will always be a red spot with useLocalExtremas true)
        "useLocalExtrema": true,
        // which field name in your data represents the latitude - default "lat"
        latField: 'lat',
        // which field name in your data represents the longitude - default "lng"
        lngField: 'lng',
        // which field name in your data represents the data value - default "value"
        valueField: 'count'
    };


    var heatmapLayer = new HeatmapOverlay(cfg);

    var map = new L.map('map', {
        layers: [baseLayer/*, heatmapLayer*/]
    }).setView([23.7301, 90.3065], 13);

    heatmapLayer.setData(testData);

    L.control.scale().addTo(map);

    map.on('click', function (e) {
        if (locationOutline != undefined) {
            map.removeLayer(locationOutline);
        }
        locationOutline = L.circle(e.latlng, overlayRadius).addTo(map);
    });

    /*var buildingOutline = L.polygon([
      [39.557040,-105.165888],
      [39.554856,-105.163232],
      [39.555838,-105.161837],
      [39.557963,-105.164502]
    ]).addTo(map);

    buildingOutline.bindPopup("Non-Existant Deer Creek Facility");*/

</script>