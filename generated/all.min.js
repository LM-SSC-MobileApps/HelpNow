angular.module("helpNow",["ngRoute","ngResource","ui.bootstrap","ngSanitize"]).config(["$routeProvider",function(e){e.when("/ind_login",{templateUrl:"views/ind-login.html"}),e.when("/login",{templateUrl:"views/login.html"}),e.when("/events",{templateUrl:"views/events.html"}),e.when("/event_map/:eventID",{templateUrl:"views/event-map.html"}),e.when("/inventory",{templateUrl:"views/inventory.html"}),e.when("/gov_login",{templateUrl:"views/gov-login.html"}),e.when("/org_event/:eventID",{templateUrl:"views/org-event.html"}),e.when("/events",{templateUrl:"views/events.html"}),e.when("/administration/",{templateUrl:"views/administration.html"}),e.when("/manage/",{templateUrl:"views/manage/manage.html"}),e.when("/regulations/",{templateUrl:"views/manage/regulations.html"}),e.when("/regulation_detail/:organizationRegulationsID",{templateUrl:"views/manage/regulation-detail.html"}),e.when("/regulation_edit/:organizationRegulationsID",{templateUrl:"views/manage/regulation-edit.html"}),e.when("/regulation_add/",{templateUrl:"views/manage/regulation-add.html"}),e.when("/regulation_add/",{templateUrl:"views/manage/regulation-add.html"}),e.when("/invite/",{templateUrl:"views/manage/team-invite.html"}),e.when("/reg_account/",{templateUrl:"views/reg-account.html"}),e.otherwise({templateUrl:"views/events.html"})}]),angular.module("helpNow").controller("AdministrationCtrl",["$scope","$location","$resource",function(e,t,n){e.setTitle("Government & Organization Administration"),e.governmentResource=n("/api/organization/type/:id",{id:1}),e.organizationResource=n("/api/organization/type/:id",{id:2}),e.loadGovernments=function(){e.governmentResource.get({},function(t){e.governmentList=t.json,e.$broadcast("GovernmentDataLoaded",{})})},e.loadOrganizations=function(){e.organizationResource.get({},function(t){e.organizationList=t.json,e.$broadcast("OrganizationDataLoaded",{})})},e.loadGovernments(),e.loadOrganizations(),e.manage=function(n){e.setCurrentOrg(n),t.path("/manage")}}]),angular.module("helpNow").controller("EventListCtrl",["$scope","$location",function(e,t){function n(){o&&e.events&&angular.forEach(e.events,function(n){var r=L.icon({iconUrl:e.getMapEventIcon(n.EventType.Description),iconSize:[43,44]}),i=L.marker([n.EventLocations[0].LAT,n.EventLocations[0].LONG],{icon:r});i.on("click",function(){e.$apply(function(){t.url("event_map/"+n.EventID)})}),i.addTo(o)})}var o;e.setTitle("Worldwide Events"),e.getMapEventIcon=function(e){return"Flood"==e?"style/images/Flood-Circle-Red.png":"Tsunami"==e?"style/images/Tsunami-Circle-Red.png":"style/images/Earthquake-Circle-Red.png"},e.setCurrentView("events"),e.$on("EventDataLoaded",function(){n()}),e.initMap=function(e){o=e,n()}}]),angular.module("helpNow").controller("EventMapCtrl",["$scope","$http","$routeParams","$resource",function(e,t,n,o){function r(){"Current"==e.locationPref.value?navigator.geolocation&&navigator.geolocation.getCurrentPosition(i):(g.removeLayer(e.locationOutline),e.helpRequest.LAT="",e.helpRequest.LONG="",e.digest())}function i(t){e.helpRequest.LAT=t.coords.latitude,e.helpRequest.LONG=t.coords.longitude,void 0!==e.locationOutline&&g.removeLayer(e.locationOutline),e.locationOutline=L.circle([t.coords.latitude,t.coords.longitude],e.overlayRadius).addTo(g),e.$digest()}function a(){var t=e.needFlags;return t.showMedical=!1,t.showShelter=!1,t.showFood=!1,t.showWater=!1,t.showEvacuation=!1,t.showMedicine=!1,!1}function s(){if(g&&e.events){for(var t=0;t<d.length;t++){var n=d[t];g.removeLayer(n)}d=[],e.showLocationMarkers&&e.buildLocationMarkers(e.locations,d,e.filterFlags),angular.forEach(d,function(e){g.addLayer(e)})}}function l(){e.requestsResource.get({eventID:e.eventID},function(t){e.requests=t.json.requests,e.locations=t.json.locations,s()})}function c(){e.urgencyResource.get({},function(t){e.urgencyList=t.json,e.selectedUrgency=e.urgencyList[0],e.helpRequest.RequestUrgencyID=e.selectedUrgency.RequestUrgencyID})}function u(){var n=JSON.stringify(e.helpRequest),o=t({method:"POST",url:"/api/resourcerequest",async:!0,headers:{"Content-Type":"application/json"},data:n});o.then(function(e){},function(t){alert("Error: "),e.hasSubmissionError=!0})}var g,d=[];e.setCurrentView("event-map"),e.requestsResource=o("/api/event/mapitems/:eventID"),e.urgencyResource=o("/api/requesturgency"),e.needRequestResource=o("/api/resourcerequest"),e.helpRequest={EventID:"",RequestStateID:"1",Notes:"Reported from App",AreaSize:"0.25 km",UnitOfMeasure:"",Quantity:""},e.eventID=1*n.eventID,e.events&&(e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),l(),c()),e.requests=[],e.overlayRadius=250,e.radiusRawVal=.25,e.sliderLabel="0.25 km",e.isMetric=!0,e.showFilters=!1,e.showEventDetails=!0,e.showHelp=!1,e.showNeeds=!1,e.filterFlags={showMedical:!0,showShelter:!0,showFood:!0,showWater:!0,showEvacuation:!0,showMedicine:!0},e.needFlags={showMedical:!1,showShelter:!1,showFood:!1,showWater:!1,showEvacuation:!1,showMedicine:!1},e.showLocationMarkers=!0,e.locationPref={value:"Current"},e.getLocation=function(){r()},e.getSelectedUrgency=function(){e.helpRequest.RequestUrgencyID=e.selectedUrgency.RequestUrgencyID},e.showValue=function(){0==e.radiusRawVal&&(e.radiusRawVal=.05),e.isMetric?(e.overlayRadius=1e3*e.radiusRawVal,e.sliderLabel=e.radiusRawVal+" km"):(e.overlayRadius=1e3*e.radiusRawVal,e.sliderLabel=e.radiusRawVal+" mi"),e.helpRequest.AreaSize=e.sliderLabel,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)},e.changeUnits=function(){e.isMetric?(e.sliderLabel=e.radiusRawVal+" km",e.overlayRadius=e.overlayRadius/.62137119,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)):(e.sliderLabel=e.radiusRawVal+" mi",e.overlayRadius=.62137119*e.overlayRadius,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)),e.helpRequest.AreaSize=e.sliderLabel},e.$on("EventDataLoaded",function(){e.event=e.getEvent(e.eventID),l(),c(),a(),s()}),e.toggleButtonClass=function(t){var n=e[t];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleButton=function(t){var n=e.filterFlags;return n[t]=!n[t],s(),!1},e.toggleFilterClass=function(t){var n=e.filterFlags,o=n[t];return o?"btn btn-toggle active":"btn btn-toggle"},e.toggleNeedsClass=function(t){var n=e.needFlags,o=n[t];return o?"btn btn-toggle active":"btn btn-toggle"},e.toggleNeed=function(t){var n=e.needFlags;return n[t]=!n[t],!1},e.initMap=function(t){g=t,g.on("click",function(t){"Other"==e.locationPref.value&&(void 0!==e.locationOutline&&g.removeLayer(e.locationOutline),e.locationOutline=L.circle(t.latlng,e.overlayRadius).addTo(g),e.helpRequest.LAT=t.latlng.lat.toFixed(3),e.helpRequest.LONG=t.latlng.lng.toFixed(3),e.$digest())}),s()},e.filterButtonClass=function(){return e.showFilters?"glyphicon glyphicon-eye-close":"glyphicon glyphicon-eye-open"},e.filterButtonText=function(){return e.showFilters?"Hide":"Show"},e.toggleFilters=function(){return e.showFilters=!e.showFilters,!1},e.toggleHelp=function(){return e.showEventDetails=!e.showEventDetails,e.showHelp=!e.showHelp,r(),!1},e.toggleNeeds=function(){var t=!1;return e.showHelp&&("Other"!=e.locationPref.value||void 0!==e.helpRequest.LAT&&""!=e.helpRequest.LAT&&void 0!==e.helpRequest.LONG&&""!=e.helpRequest.LONG||(t=!0),void 0===e.helpRequest.AreaSize&&(t=!0),(void 0===e.helpRequest.Quantity||0==e.helpRequest.Quantity)&&(t=!0)),t?alert("Missing Required Field(s)"):(e.showHelp=!e.showHelp,e.showNeeds=!e.showNeeds),!1},e.validateNumber=function(e){var t=e||window.event,n=t.keyCode||t.which;return!t.shiftKey&&!t.altKey&&!t.ctrlKey&&n>=48&&57>=n||8==n||9==n||13==n||37==n||39==n||46==n||45==n?!1:(t.returnValue=!1,t.preventDefault&&t.preventDefault(),!0)},e.sendNeedRequest=function(){var t=!1,n=e.needFlags;if(e.showNeeds&&(n.showMedical||n.showShelter||n.showFood||n.showMedicine||n.showWater||n.showEvacuation||(t=!0)),t)alert("Specify a Need");else{e.helpRequest.EventID=e.eventID;var o=e.helpRequest.AreaSize.split(" ");e.helpRequest.AreaSize=o[0],e.helpRequest.UnitOfMeasure=o[1],n.showMedicalNeed&&(e.helpRequest.ResourceTypeID="4",u()),n.showShelter&&(e.helpRequest.ResourceTypeID="3",u()),n.showFood&&(e.helpRequest.ResourceTypeID="1",u()),n.showMedicine&&(e.helpRequest.ResourceTypeID="6",u()),n.showWater&&(e.helpRequest.ResourceTypeID="2",u()),n.showEvacuation&&(e.helpRequest.ResourceTypeID="5",u()),a(),g.removeLayer(e.locationOutline),e.showNeeds=!e.showNeeds,e.showEventDetails=!e.showEventDetails,e.hasSubmissionError||alert("Request(s) successfully submitted")}return!1}}]),angular.module("helpNow").controller("GovLoginCtrl",["$scope",function(e){e.setCurrentView("govs")}]),angular.module("helpNow").controller("IndLoginCtrl",["$scope",function(e){e.setCurrentView("inds")}]),angular.module("helpNow").controller("InventoryCtrl",["$scope","$http","$routeParams","$resource",function(e,t,n,o){function r(){if(c&&e.resourceLocations){for(var t=0;t<u.length;t++){var n=u[t];c.removeLayer(n)}u=[],a(u),angular.forEach(u,function(e){c.addLayer(e)})}}function i(){e.resourceLocation.get({},function(t){e.resourceLocations=t.json;var n=e.resourceLocations.filter(function(t){return t.OrganizationID==e.userOrgID});e.resourceLocations=n,e.$broadcast("ResourceLocationDataLoaded",{})})}function a(t){angular.forEach(e.resourceLocations,function(e){var n=L.icon({iconUrl:"style/images/resources.png",iconSize:[60,60],iconAnchor:[30,30]}),o=s(e,n);t.push(o)})}function s(e,t){var n=L.marker([e.LAT,e.LONG],{icon:t});return n.id=e.ResourceLocationID,n.bindPopup(l(e)).on("click",function(){}),n}function l(e){var t="<strong>"+e.Description+"</strong><br/>"+e.PrimaryPOCPhone+"<hr/>";return e.ResourceLocationInventories.forEach(function(e){t+=e.ResourceType.Description+": "+e.Quantity+" "+e.ResourceTypeUnitOfMeasure.Description+"<br/>"}),t}var c,u=[];e.setTitle("Inventory Management"),e.setCurrentView("inventory"),e.resourceLocation=o("/api/resourcelocation"),e.currentResourceLocation={},e.userOrgID=1,i(),e.overlayRadius=250,e.radiusRawVal=.25,e.sliderLabel="0.25 km",e.isMetric=!0,e.showResourceLocations=!0,e.showNewForm=!1,e.showTransportationOptions=!1,e.showLocationInventory=!1,e.showAir=!1,e.showGround=!1,e.showWater=!1,e.$on("ResourceLocationDataLoaded",function(){r()}),e.initMap=function(e){c=e,r()},e.centerMapToLongLat=function(e,t){c&&(c.setZoom(12),c.panTo(new L.LatLng(t,e)))},e.resourceLocationClick=function(t,n,o){c&&(c.setZoom(12),c.panTo(new L.LatLng(n,t)),e.setCurrentResourceLocationByID(o),e.showInventory())},e.setCurrentResourceLocationByID=function(t){e.resourceLocations.forEach(function(n){n.ResourceLocationID==t&&(e.currentResourceLocation=n)})},e.toggleTransportClass=function(t){var n=e[t];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleTransport=function(t){return e[t]=!e[t],!1},e.showNewSiteForm=function(){return e.showNewForm=!e.showNewForm,e.showResourceLocations=!e.showResourceLocations,!1},e.showTransportation=function(){return e.showTransportationOptions=!e.showTransportationOptions,e.showNewForm=!e.showNewForm,!1},e.showInventory=function(){return e.showResourceLocations=!e.showResourceLocations,e.showLocationInventory=!e.showLocationInventory,!1},e.removeInventoryItem=function(){return alert("Coming Soon - In Developement"),!1},e.saveResourceLocation=function(){return alert("Coming Soon - In Developement"),e.showTransportationOptions=!e.showTransportationOptions,e.showResourceLocations=!e.showResourceLocations,!1},e.removeResourceLocation=function(){return e.showTransportationOptions=!e.showTransportationOptions,e.showResourceLocations=!e.showResourceLocations,!1},e.comingSoon=function(){return alert("Coming Soon - In Developement"),!1},e.validateNumber=function(e){var t=e||window.event,n=t.keyCode||t.which;return!t.shiftKey&&!t.altKey&&!t.ctrlKey&&n>=48&&57>=n||8==n||9==n||13==n||37==n||39==n||46==n||45==n?!1:(t.returnValue=!1,t.preventDefault&&t.preventDefault(),!0)}}]),angular.module("helpNow").controller("LoginCtrl",["$scope","$http","$location","$routeParams","$resource",function(e,t,n,o,r){function i(){var o=JSON.stringify(e.userCreds),r=t({method:"POST",url:"/api/account/login",async:!0,headers:{"Content-Type":"application/json"},data:o});r.then(function(t){if(e.users=t.data.json,e.currentUser=e.users[0],void 0===e.currentUser)alert("Incorrect Username/Password combination.\nPlease try again");else{var o={AccountID:e.currentUser.AccountID,FirstName:e.currentUser.FirstName,LastName:e.currentUser.LastName,OrganizationID:e.currentUser.Organization.OrganizationID,OrganizationName:e.currentUser.Organization.Name};e.setCurrentUser(o),e.setCurrentOrg(e.currentUser.Organization),sessionStorage.setItem("user",JSON.stringify(o)),e.$broadcast("CurrentUserLoaded",{}),n.path("#")}},function(e){alert("Login Error - Please Try Again")})}e.setCurrentView("login"),e.setTitle("Login"),e.validateUser=function(){void 0===e.userCreds.username||void 0===e.userCreds.password?alert("Missing Username or Password"):i()}}]),angular.module("helpNow").controller("ManageCtrl",["$scope","$location","$resource","Invitation","$uibModal",function(e,t,n,o,r){e.invitesResource=n("/api/inviterequest/organizationinvites/:accountid",{accountid:e.currentUser.AccountID}),e.setTitle("Organization Management"),e.loadInvites=function(){e.invitesResource.get({},function(t){e.invites=t.json,e.$broadcast("InviteDataLoaded",{})})},e.loadInvites(),e.deleteInvite=function(n){e.modalInstance=r.open({templateUrl:"/manage/invite-modal-delete.html",controller:function(e){this.invitation=n,this.Invitation=o,e.deleteInvite=function(e){o["delete"]({inviteid:e.InviteID}),t.path("/manage")}},controllerAs:"model"})},e.teamResource=n("/api/account/organizationmembers/:accountid",{accountid:e.currentUser.AccountID}),e.loadTeam=function(){e.teamResource.get({},function(t){e.team=t.json,e.$broadcast("TeamDataLoaded",{})})},e.loadTeam(),e.go=function(e){t.path(e)}}]),angular.module("helpNow").controller("OrgEventCtrl",["$scope","$routeParams","$resource","$sce",function(e,t,n,o){function r(){"Current"==e.locationPref.value?navigator.geolocation&&navigator.geolocation.getCurrentPosition(i):(e.mappingLoc.LAT=null,e.mappingLoc.LONG=null,s())}function i(t){e.mappingLoc.LAT=t.coords.latitude,e.mappingLoc.LONG=t.coords.longitude,s(),e.$digest()}function a(){e.locationOutline&&y.removeLayer(e.locationOutline)}function s(){a(),e.showFindPanel&&e.mappingLoc.LAT&&e.mappingLoc.LONG?e.locationOutline=L.circle([e.mappingLoc.LAT,e.mappingLoc.LONG],250).addTo(y):e.showDeployPanel&&e.deployment.LAT&&e.deployment.LONG&&(e.locationOutline=L.circle([e.deployment.LAT,e.deployment.LONG],250).addTo(y))}function l(e){return"Water"==e?"style/images/markers/dot-blue.png":"First Aid"==e?"style/images/markers/dot-red.png":"Shelter"==e?"style/images/markers/dot-orange.png":"Evacuation"==e?"style/images/markers/dot-purple.png":"Medicine"==e?"style/images/markers/dot-cyan.png":"style/images/markers/dot-green.png"}function c(e){return"Water"==e?"style/images/Water-Circle-Red.png":"First Aid"==e?"style/images/First Aid-Circle-Red.png":"Shelter"==e?"style/images/Shelter-Circle-Red.png":"Evacuation"==e?"style/images/Evacuation-Circle-Red.png":"Medicine"==e?"style/images/Medicine-Circle-Red.png":"style/images/Food-Circle-Red.png"}function u(e){angular.forEach(e,function(e){var t=L.icon({iconUrl:l(e.ResourceType.Description),iconSize:[27,27],iconAnchor:[13,41],popupAnchor:[0,-20]}),n=L.marker([e.LAT,e.LONG],{icon:t});n.bindPopup("<strong>"+e.ResourceType.Description+" ("+e.Quantity+")</strong><br/>"+e.Notes),R.push(n)})}function g(){if(e.requestClusters){var t=e.requestClusters.filter(function(t){var n=t.ResourceType.Description;return e.shouldDisplayMarker(n,e.filterFlags)});angular.forEach(t,function(e){var t=L.icon({iconUrl:c(e.ResourceType.Description),iconSize:[50,50],iconAnchor:[25,25]}),n=L.marker([e.LAT,e.LONG],{icon:t});n.bindPopup("<strong>"+e.ResourceType.Description+"</strong><br/>"+e.Notes),R.push(n)})}}function d(e){var t={radius:100,maxOpacity:.5,scaleRadius:!1,useLocalExtrema:!0,latField:"LAT",lngField:"LONG",valueField:"Quantity"},n=new HeatmapOverlay(t),o={data:e};n.setData(o),R.push(n)}function p(){if(e.distributionCenters){var t=e.distributionCenters.filter(function(t){return e.shouldDisplayLocationMarker(t,e.filterFlags)});angular.forEach(t,function(t){var n=t.OrganizationID==e.currentOrg.OrganizationID,o=n?"style/images/Distribution-Center-DBox-Blue.png":"style/images/Distribution-Center-Box-Blue.png",r=L.icon({iconUrl:o,iconSize:[60,60],iconAnchor:[30,30]}),i=e.buildLocationMarker(t,r);R.push(i)})}}function h(){if(y&&e.events){for(var t=y.getZoom(),n=0;n<R.length;n++){var o=R[n];y.removeLayer(o)}R=[];var r=e.requests.filter(function(t){var n=t.ResourceType.Description;return e.shouldDisplayMarker(n,e.filterFlags)});e.showHeatmap&&d(r),e.showNeedsMarkers&&t>7&&u(r),e.showClusters&&g(),e.showLocationMarkers&&e.buildLocationMarkers(e.locations,R,e.filterFlags),e.showDistCenterMarkers&&p(),angular.forEach(R,function(e){y.addLayer(e)})}}function m(){e.requestsResource.get({eventID:e.eventID},function(t){e.requests=t.json.requests,e.locations=t.json.locations,e.requestClusters=t.json.requestClusters,e.distributionCenters=t.json.distributionCenters,h()})}function v(e){return e*(Math.PI/180)}function f(e,t,n,o){var r=6371,i=v(n-e),a=v(o-t),s=Math.sin(i/2)*Math.sin(i/2)+Math.cos(v(e))*Math.cos(v(n))*Math.sin(a/2)*Math.sin(a/2),l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return r*l}function w(){var t=0,n=Number.MAX_VALUE,o=e.distributionCenters.filter(function(t){return e.shouldDisplayLocationMarker(t,e.matchingFlags)&&t.OrganizationID==e.currentOrg.OrganizationID}),r=o.map(function(o){var r=f(o.LAT,o.LONG,e.mappingLoc.LAT,e.mappingLoc.LONG);return r>=t&&(t=r),n>=r&&(n=r),{center:o,dist:r.toFixed(3)}}),i=r.map(function(e){var o=(e.dist-n)/(t-n);return e.score=o,e});return i.sort(function(e,t){return e.score-t.score}),i.length>3&&(i=i.slice(0,3)),e.hasMatches=i.length>0,i}var y,R=[];e.setCurrentView("org-events"),e.requestsResource=n("/api/event/mapitems/:eventID"),e.eventID=1*t.eventID,e.events&&(e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),m()),e.requests=[],e.showFilters=!1,e.showFindPanel=!1,e.showFindResults=!1,e.showMappingError=!1,e.showDeployPanel=!1,e.showHeatmap=!1,e.showClusters=!1,e.showNeedsMarkers=!0,e.showLocationMarkers=!1,e.showDistCenterMarkers=!1,e.filterFlags={showMedical:!0,showShelter:!0,showFood:!0,showWater:!0,showEvacuation:!0,showMedicine:!0},e.matchingFlags={showMedical:!1,showShelter:!1,showFood:!1,showWater:!1,showEvacuation:!1,showMedicine:!1},e.mappingLoc={},e.deployment={},e.locationPref={value:"Current"},e.getLocation=function(){r()},e.getMatchResources=function(){var t=[],n=e.matchingFlags;return n.showMedical&&t.push("First Aid"),n.showShelter&&t.push("Shelter"),n.showFood&&t.push("Food"),n.showWater&&t.push("Water"),n.showEvacuation&&t.push("Evacuation"),n.showMedicine&&t.push("Medicine"),t.join(", ")},e.$on("EventDataLoaded",function(){e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),m(),h()}),e.toggleButtonClass=function(t){var n=e[t];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleButton=function(t){return e[t]=!e[t],h(),!1},e.toggleResourceFilter=function(t){var n=e.filterFlags;return n[t]=!n[t],h(),!1},e.toggleResourceButtonClass=function(t){var n=e.filterFlags,o=n[t];return o?"btn btn-toggle active":"btn btn-toggle"},e.toggleMatchingFilter=function(t){var n=e.matchingFlags;return n[t]=!n[t],h(),!1},e.toggleMatchingButtonClass=function(t){var n=e.matchingFlags,o=n[t];return o?"btn btn-toggle active":"btn btn-toggle"},e.getCleanLocationText=function(t){return o.trustAsHtml(e.buildLocationDetails(t))},e.initMap=function(t){y=t,y.on("zoomend",function(){h()}),y.on("click",function(t){e.showFindPanel&&!e.showFindResults&&"Other"==e.locationPref.value?(e.mappingLoc.LAT=t.latlng.lat.toFixed(3),e.mappingLoc.LONG=t.latlng.lng.toFixed(3),s(),e.$digest()):e.showDeployPanel&&(e.deployment.LAT=t.latlng.lat.toFixed(3),e.deployment.LONG=t.latlng.lng.toFixed(3),s(),e.$digest())}),h()},e.filterButtonText=function(){return e.showFilters?"Hide":"Show"},e.toggleFilters=function(){e.showFilters=!e.showFilters},e.toggleFindPanel=function(){e.showFindPanel=!e.showFindPanel,e.showFindPanel?(e.showDistCenterMarkers=!0,r(),h()):a()},e.toggleDeployPanel=function(){e.showDeployPanel=!e.showDeployPanel,e.showDeployPanel&&(r(),e.showDistCenterMarkers=!0,h())},e.findMatches=function(){return e.showMappingError=!1,e.mappingLoc.LAT&&e.mappingLoc.LONG&&0!=e.getMatchResources().length?(e.matches=w(),e.showFindResults=!0,!1):(e.showMappingError=!0,!1)},e.showLocation=function(e,t){y.setView([e,t],y.getZoom())},e.backToFind=function(){return e.showFindResults=!1,!1},e.panelIsOpen=function(){return e.showFindPanel||e.showFilters||e.showDeployPanel},e.setCurrentView("org-event")}]),angular.module("helpNow").controller("RegAccountCtrl",["$scope","$http","$location","$routeParams","$resource",function(e,t,n,o,r){function i(){var o=JSON.stringify(e.userAccount),r=t({method:"POST",url:"/api/account",async:!0,headers:{"Content-Type":"application/json"},data:o});r.then(function(e){alert("Account Successfully Created"),n.path("#")},function(e){alert("Error: ")})}e.setCurrentView("reg-account"),e.setTitle("Register an Account"),e.showUsername=!0,e.showUser=!1,e.userAccount={OrganizationGroupID:1,Active:!0,AccountRoleID:3,CreateDate:new Date},e.showUserForm=function(){var t=!1;void 0===e.userAccount.Username||void 0===e.userAccount.Password||void 0===e.confirmedPassword?(alert("Missing field(s)"),t=!0):e.userAccount.Password!=e.confirmedPassword&&(alert("Passwords do not match"),t=!0),t||(e.showUser=!0,e.showUsername=!1)},e.showUsernameForm=function(){e.showUser=!1,e.showUsername=!0},e.submitUserReg=function(){var t=!1;(void 0===e.userAccount.FirstName||void 0===e.userAccount.LastName||void 0===e.userAccount.Email)&&(alert("Missing field(s)"),t=!0),t||i()}}]),angular.module("helpNow").controller("RegulationAddCtrl",["$scope","$resource","$routeParams","Regulation","$location",function(e,t,n,o,r){e.newReg=new o,e.newReg.OrganizationID=e.currentOrg.OrganizationID,e.go=function(e){r.path(e)},e.addRegulation=function(e){console.log(e.Narrative),console.log(e.Summary),o.save(e),r.path("/regulations")}}]),angular.module("helpNow").controller("RegulationDetailCtrl",["$scope","$resource","$routeParams","Regulation","$location",function(e,t,n,o,r){e.regulationResource=o.get({id:n.organizationRegulationsID},function(t){e.regulation=t.json,e.$broadcast("RegulationDataLoaded",{})}),e.go=function(e){r.path(e)}}]),angular.module("helpNow").controller("RegulationEditCtrl",["$scope","$resource","$routeParams","Regulation","$location","$uibModal",function(e,t,n,o,r,i){e.regulationResource=o.get({id:n.organizationRegulationsID},function(t){e.editRegulations=t.json,e.editReg=e.editRegulations[0],e.$broadcast("RegulationDataLoaded",{})}),e.updateRegulation=function(e){o.update({id:n.organizationRegulationsID},e),r.path("/regulations")},e.deleteRegulation=function(t){e.modalInstance=i.open({templateUrl:"/manage/regulations-modal-delete.html",controller:function(e){this.regulation=t,this.Regulation=o,e.deleteReg=function(){o["delete"]({id:t.OrganizationRegulationsID}),r.path("/regulations")}},controllerAs:"model"})},e.go=function(e){r.path(e)}}]),angular.module("helpNow").controller("RegulationsCtrl",["$scope","$resource","$location",function(e,t,n){e.regulationsResource=t("api/organizationregulation/account/:accountId",{accountId:e.currentUser.AccountID}),e.loadRegulations=function(){e.regulationsResource.get({},function(t){e.regulations=t.json,e.$broadcast("RegulationDataLoaded",{})})},e.loadRegulations(),e.setCurrentView("regulations"),e.$on("RegulationDataLoaded",function(){}),e.go=function(e){n.path(e)}}]),angular.module("helpNow").controller("RootCtrl",["$scope","$location","$http","$resource",function(e,t,n,o){var r="Eng",i="";e.eventsResource=o("/api/event"),e.currentUser=JSON.parse(sessionStorage.getItem("user")),e.currentOrg=JSON.parse(sessionStorage.getItem("user")),e.title="Worldwide Events",e.loadEvents=function(){e.eventsResource.get({},function(t){e.events=t.json,e.$broadcast("EventDataLoaded",{})})},e.setShowLogin=function(){e.currentUser?e.showLogin=!1:e.showLogin=!0},e.getEventIcon=function(e){return"Flood"==e?"style/images/flood.png":"Tsunami"==e?"style/images/Tsunami.png":"style/images/earthquake.png"},e.getMenuClass=function(e){return e==i?"active":""},e.setCurrentView=function(e){i=e},e.setTitle=function(t,n){e.title=t,e.imageSrc=n},e.setCurrentUser=function(t){e.currentUser=t},e.setCurrentOrg=function(t){e.currentOrg=t},e.setCurrentLanguage=function(t){r=t,"Ben"==t?n.get("i18n/text-BEN.json").success(function(t){e.text=t}).error(function(e){alert(e)}):n.get("i18n/text-ENG.json").success(function(t){e.text=t}).error(function(e){alert(e)})},e.getLanguageClass=function(e){return r==e?"active":""},e.setCurrentLanguage("Eng"),e.getResourcesForEvent=function(t){for(var n=[],o=0;o<e.resources.length;o++){var r=e.resources[o];r.eventID==t&&n.push(r)}return n.length>0?n:{}},e.getEvent=function(t){for(var n=0;n<e.events.length;n++){var o=e.events[n];if(o.EventID==t)return o}return{}},e.getLocationIcon=function(t){var n=t.ResourceLocationInventories,o=e.currentOrg&&t.OrganizationID==e.currentOrg.OrganizationID;if(n.length>1)return o?"style/images/Resources-DBox-Blue.png":"style/images/Resources-Box-Blue.png";var r=o?"DDiamond-Blue":"Diamond-Blue",i=n[0].ResourceType.Description;return"Water"==i?"style/images/Water-"+r+".png":"First Aid"==i?"style/images/First Aid-"+r+".png":"Shelter"==i?"style/images/Shelter-"+r+".png":"Evacuation"==i?"style/images/Evacuation-"+r+".png":"Medicine"==i?"style/images/Medicine-"+r+".png":"style/images/Food-"+r+".png"},e.buildLocationDetails=function(e){var t="<strong>"+e.Organization.Name+"</strong><br/>"+e.PrimaryPOCName+"<br/>"+e.PrimaryPOCPhone+"<hr/>";return e.ResourceLocationInventories.forEach(function(e){t+=e.ResourceType.Description+": "+e.Quantity+" "+e.ResourceTypeUnitOfMeasure.Description+"<br/>"}),t},e.buildLocationMarker=function(t,n){var o=L.marker([t.LAT,t.LONG],{icon:n});return o.bindPopup(e.buildLocationDetails(t)),o},e.buildLocationMarkers=function(t,n,o){if(t){var r=t.filter(function(t){return e.shouldDisplayLocationMarker(t,o)});angular.forEach(r,function(t){var o=L.icon({iconUrl:e.getLocationIcon(t),iconSize:[60,60],iconAnchor:[30,30]}),r=e.buildLocationMarker(t,o);n.push(r)})}},e.shouldDisplayMarker=function(e,t){return"Water"==e&&t.showWater||"Shelter"==e&&t.showShelter||"Food"==e&&t.showFood||"Evacuation"==e&&t.showEvacuation||"First Aid"==e&&t.showMedical||"Medicine"==e&&t.showMedicine},e.shouldDisplayLocationMarker=function(t,n){for(var o=t.ResourceLocationInventories,r=0;r<o.length;r++)if(e.shouldDisplayMarker(o[r].ResourceType.Description,n))return!0;return!1},e.loadEvents(),e.setShowLogin(),e.redirectToLogin=function(){e.showLogin=!1,t.path("/login")},e.resources=[{id:1,eventID:1,resourceType:"First Aid",lat:23.718,"long":90.355,provider:"NGO #1",message:""},{id:2,eventID:1,resourceType:"First Aid",lat:23.719,"long":90.374,provider:"NGO #2",message:""},{id:3,eventID:1,resourceType:"First Aid",lat:23.765,"long":90.398,provider:"NGO #3",message:""},{id:4,eventID:1,resourceType:"Water",lat:23.767,"long":90.41,provider:"NGO #4",message:""},{id:5,eventID:1,resourceType:"Evacuation Site",lat:23.73,"long":90.365,provider:"",message:"No more than 1 bag per person.  Only bring what you can carry."},{id:6,eventID:1,resourceType:"Evacuation Site",lat:23.75,"long":90.43,provider:"",message:"No more than 1 bag per person.  Only bring what you can carry."}]}]),angular.module("helpNow").controller("TeamInviteCtrl",["$scope","$resource","$routeParams","Invitation","$location","$uibModal",function(e,t,n,o,r,i){e.newInvite=new o,e.newInvite.OrganizationID=e.currentOrg.OrganizationID,console.log("$scope.currentOrg.OrganizationID"+e.currentOrg.OrganizationID),e.sendInvite=function(t){o.save(t),e.confirmEmail(t)},e.confirmEmail=function(t){e.modalInstance=i.open({templateUrl:"/manage/team-invite-modal-confirm.html",controller:function(e){this.invitation=t,e.confirm=function(){r.path("/manage")}},controllerAs:"model"})},e.go=function(e){r.path(e)}}]),angular.module("helpNow").directive("filters",function(){return{scope:{togglefunc:"=",classfunc:"="},templateUrl:"views/fragments/resource-filters.html"}}),angular.module("helpNow").directive("map",function(){return{link:function(e,t,n){var o=n.mapCenter.split(","),r=n.mapZoom,i="pk.eyJ1IjoiZGlnaXRhbGdsb2JlIiwiYSI6ImNpZjc5N3NiMTA5OXlzb2x6c3FyZHQ3cTUifQ.88yZYJc78Z2MAnkX2fOjuw",a='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery � <a href="http://mapbox.com">Mapbox</a>',s="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ",l=(L.tileLayer(s,{id:"mapbox.light",attribution:a}),L.tileLayer(s,{id:"mapbox.streets",attribution:a}),L.esri.tiledMapLayer({url:"https://services.digitalglobe.com/earthservice/gis/0688362c-8f94-4016-95c3-172c2ab72023/rest/services/DigitalGlobe:ImageryTileService/MapServer",attribution:"DigitalGlobe Basemap, 2015"})),c=(L.tileLayer.wms("https://services.digitalglobe.com/mapservice/wmsaccess?connectid=0688362c-8f94-4016-95c3-172c2ab72023",{layers:"DigitalGlobe:Imagery",format:"image/png",transparent:!0,attribution:"DigitalGlobe 2015"}),L.esri.tiledMapLayer({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",attribution:"Esri 2015"}),new L.tileLayer("https://{s}.tiles.mapbox.com/v4/digitalglobe.n6nhclo2/{z}/{x}/{y}.png?access_token="+i,{minZoom:2,maxZoom:19,attribution:'(c) <a href="http://microsites.digitalglobe.com/interactive/basemap_vivid/">DigitalGlobe</a> , (c) OpenStreetMap, (c) Mapbox'})),u=(new L.tileLayer("https://{s}.tiles.mapbox.com/v4/digitalglobe.n6ngnadl/{z}/{x}/{y}.png?access_token="+i,{minZoom:2,maxZoom:19,attribution:'(c) <a href="http://microsites.digitalglobe.com/interactive/basemap_vivid/">DigitalGlobe</a>'}),new L.tileLayer("https://{s}.tiles.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token="+i,{minZoom:2,maxZoom:19,attribution:"(c) OpenStreetMap , (c) Mapbox"}),L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:a,noWrap:!0,minZoom:2,maxZoom:18})),g=new L.map("map",{layers:[u],maxBounds:[[-90,-180],[90,180]]}).setView(o,r);L.control.scale().addTo(g),g.attributionControl.setPrefix("");var d={"Base Open Street Maps":u,"DigitalGlobe Basemap +Vivid with Streets":c,"DigitalGlobe Basemap: REST":l};L.control.layers(d,null,{collapsed:!0}).addTo(g),g.addControl(new L.Control.Search({url:"http://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],circleLocation:!1,markerLocation:!1,autoType:!1,autoCollapse:!0,minLength:2,zoom:13})),e.initMap&&e.initMap(g)}}}),angular.module("helpNow").factory("Invitation",function(e){return e("api/inviterequest/:inviteid",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("Regulation",function(e){return e("api/organizationregulation/:id",null,{update:{method:"PUT"}})});