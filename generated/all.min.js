angular.module("helpNow",["ngRoute","ngResource","ui.bootstrap","ngSanitize"]).config(["$routeProvider",function(e){e.when("/ind_login",{templateUrl:"views/ind-login.html"}),e.when("/login",{templateUrl:"views/login.html"}),e.when("/events",{templateUrl:"views/events.html"}),e.when("/event_map/:eventID",{templateUrl:"views/event-map.html"}),e.when("/inventory",{templateUrl:"views/inventory/inventory.html"}),e.when("/gov_login",{templateUrl:"views/gov-login.html"}),e.when("/org_event/:eventID",{templateUrl:"views/org-event.html"}),e.when("/create_deployment/:eventID/:lat/:long",{templateUrl:"views/deployment.html"}),e.when("/modify_deployment/:locationID",{templateUrl:"views/deployment.html"}),e.when("/events",{templateUrl:"views/events.html"}),e.when("/administration/",{templateUrl:"views/admin/administration.html"}),e.when("/add_org/:orgTypeID",{templateUrl:"views/admin/add-organization.html"}),e.when("/org_address/:orgID",{templateUrl:"views/manage/org-address.html"}),e.when("/manage/",{templateUrl:"views/manage/manage.html"}),e.when("/regulations/",{templateUrl:"views/manage/regulations.html"}),e.when("/regulation_detail/:organizationRegulationsID",{templateUrl:"views/manage/regulation-detail.html"}),e.when("/regulation_edit/:organizationRegulationsID",{templateUrl:"views/manage/regulation-edit.html"}),e.when("/regulation_add/",{templateUrl:"views/manage/regulation-add.html"}),e.when("/regulation_add/",{templateUrl:"views/manage/regulation-add.html"}),e.when("/invite/",{templateUrl:"views/manage/team-invite.html"}),e.when("/assign_poc/",{templateUrl:"views/manage/assign-poc.html"}),e.when("/reg_account/",{templateUrl:"views/reg-account.html"}),e.when("/demo/",{templateUrl:"views/manage/demo.html"}),e.otherwise({templateUrl:"views/events.html"})}]),angular.module("helpNow").controller("AdministrationCtrl",["$scope","$location","$resource","Organization","$uibModal",function(e,o,t,n,r){e.setTitle("Government & Organization Administration"),e.governmentResource=t("/api/organization/type/:id",{id:1}),e.organizationResource=t("/api/organization/type/:id",{id:2}),e.loadGovernments=function(){e.governmentResource.get({},function(o){e.governmentList=o.json,e.$broadcast("GovernmentDataLoaded",{})})},e.loadOrganizations=function(){e.organizationResource.get({},function(o){angular.module("helpNow").controller("AdministrationCtrl",["$scope","$location","$resource","Organization","$uibModal",function(e,o,t,n,r){e.setTitle("Government & Organization Administration"),e.governmentResource=t("/api/organization/type/:id",{id:1}),e.organizationResource=t("/api/organization/type/:id",{id:2}),e.loadGovernments=function(){e.governmentResource.get({},function(o){e.governmentList=o.json,e.$broadcast("GovernmentDataLoaded",{})})},e.loadOrganizations=function(){e.organizationResource.get({},function(o){e.organizationList=o.json,e.$broadcast("OrganizationDataLoaded",{})})},e.loadGovernments(),e.loadOrganizations(),e.manage=function(t){e.setCurrentOrg(t),o.path("/manage")},e.addOrg=function(t){e.modalInstance=r.open({templateUrl:"/admin/admin-modal-add-org.html",controller:function(e){this.org=t,this.orgType=1==t.OrganizationTypeID?"government":"organization",this.Organization=n,e.addOrg=function(e){n.save(e),o.path("/administration")}},controllerAs:"model"})},e.removeOrg=function(t){e.modalInstance=r.open({templateUrl:"/admin/admin-modal-remove.html",controller:function(e){this.org=t,this.orgType=1==t.OrganizationTypeID?"government":"organization",this.Organization=n,e.removeOrg=function(e){n["delete"]({id:e.OrganizationID}),o.path("/administration")}},controllerAs:"model"})}}]),e.organizationList=o.json,e.$broadcast("OrganizationDataLoaded",{})})},e.loadGovernments(),e.loadOrganizations(),e.manage=function(t){e.setCurrentOrg(t),o.path("/manage")},e.addOrg=function(t){e.modalInstance=r.open({templateUrl:"/admin/admin-modal-add-org.html",controller:function(e){this.org=t,this.orgType=1==t.OrganizationTypeID?"government":"organization",this.Organization=n,e.addOrg=function(e){n.save(e),o.path("/administration")}},controllerAs:"model"})},e.removeOrg=function(t){e.modalInstance=r.open({templateUrl:"/admin/admin-modal-remove.html",controller:function(e){this.org=t,this.orgType=1==t.OrganizationTypeID?"government":"organization",this.Organization=n,e.removeOrg=function(e){n["delete"]({id:e.OrganizationID}),o.path("/administration")}},controllerAs:"model"})}}]),angular.module("helpNow").controller("AssignPocCtrl",["$scope","$resource","$routeParams","Organization","$location","$uibModal",function(e,o,t,n,r,a){e.teamResource=o("/api/account/organizationmembers/:accountid",{accountid:e.currentUser.AccountID}),e.loadTeam=function(){e.teamResource.get({},function(o){e.team=o.json,e.$broadcast("TeamDataLoaded",{})})},e.loadTeam(),e.orgResource=o("/api/organization/:id",{id:e.currentOrg.OrganizationID}),e.loadOrg=function(){e.orgResource.get({},function(o){orgs=o.json,e.org=orgs[0],console.log("org.PrimaryPOC: "+e.org.PrimaryPOC),e.$broadcast("OrgDataLoaded",{})})},e.loadOrg(),e.updateOrg=function(o){n.update({id:e.currentOrg.OrganizationID},o),e.modalInstance=a.open({templateUrl:"/manage/team-poc-modal-confirm.html",controller:function(e){e.confirm=function(){r.path("/manage")}},controllerAs:"model"})},e.go=function(e){r.path(e)}}]),angular.module("helpNow").controller("DemoCtrl",["$scope","$http","Event","EventLocation","ResourceRequest","$location","ResourceLocation",function(e,o,t,n,r,a,i){e.demoRunning=!1,o.get("data/scenario.json").success(function(o){e.scenarioData=o,console.log("Success loading scenario data: "+o)}).error(function(e){console.log("Error loading scenario data:  "+e)}),e.go=function(e){a.path(e)},e.startDemo=function(){console.log("starting demo run"),e.demoRunning=!0,angular.forEach(e.scenarioData,function(e,o){switch(console.log("item.Type : "+e.Type),e.Type){case"Event":var a=angular.fromJson(e.Data);t.save(a,function(e){var o=e.json;console.log(o),angular.forEach(a.EventLocations,function(e,t){var r=a.EventLocations[t];r.EventID=o.EventID,setTimeout(function(){n.save(r,function(e){var o=e.json;console.log(o)})},a.WaitTime)}),angular.forEach(a.ResourceRequests,function(e,t){console.log(t+":"+e);var n=a.ResourceRequests[t];n.EventID=o.EventID,setTimeout(function(){r.save(n,function(e){var o=e.json;console.log(o)})},n.WaitTime)}),angular.forEach(a.ResourceLocations,function(e,t){var n=a.ResourceLocations[t];n.EventID=o.EventID,setTimeout(function(){i.save(n,function(e){var o=e.json;console.log(o)})},n.WaitTime)})});break;default:console.log("I'm lost")}}),e.demoRunning=!1}}]),angular.module("helpNow").controller("DeploymentCtrl",["$scope","$routeParams","$resource","$sce","$location","$http",function(e,o,t,n,r,a){function i(){var o=JSON.stringify(e.deployment),t=a({method:"POST",url:"/api/resourcelocation",async:!0,headers:{"Content-Type":"application/json"},data:o});t.then(function(o){e.deployment.ResourceLocationID=o.data.json.ResourceLocationID},function(e){alert(e.data.err)})}function s(){var o=JSON.stringify(e.deployment),t=a({method:"PUT",url:"/api/resourcelocation/"+e.deployment.ResourceLocationID,async:!0,headers:{"Content-Type":"application/json"},data:o});t.then(function(e){},function(e){console.log(e),alert("error: "+e.data.err)})}e.showDistributionCenters=!1,e.deploymentsResource=t("/api/resourcelocation/:id"),e.distCenterResource=t("/api/resourcelocation/dist-center/all"),e.setTitle("Resource Deployment","style/images/Distribution-Center.png"),e.distCenterResource.get({},function(o){var t=o.json;t=t.filter(function(o){return o.OrganizationID==e.currentOrg.OrganizationID}),e.distCenters=t}),o.locationID?(e.deployment={},e.deploymentsResource.get({id:o.locationID},function(o){var t=o.json[0];t.ResourceLocationStatusID=t.ResourceLocationStatusID+"",e.deployment=t,e.events&&(e.event=e.getEvent(e.deployment.EventID))})):e.deployment={EventID:o.eventID,LAT:o.lat,LONG:o["long"],ResourceLocationTypeID:2,OrganizationID:e.currentOrg.OrganizationID,ResourceLocationStatusID:"1",ResourceLocationTransports:[]},e.events&&(e.event=e.getEvent(e.deployment.EventID)),e.$on("EventDataLoaded",function(){e.event=e.getEvent(e.deployment.EventID)}),e.cancel=function(){var o="org_event/"+e.deployment.EventID;r.path(o)},e.removeInventory=function(o){var t=a({method:"DELETE",url:"/api/resourcelocationinventory/"+o.ResourceLocationInventoryID,async:!0,headers:{"Content-Type":"application/json"}});t.then(function(t){for(var n=e.deployment.ResourceLocationInventories,r=0,a=0;a<n.length;a++){var i=n[a];if(o.ResourceLocationInventoryID==i.ResourceLocationInventoryID){r=a;break}}e.deployment.ResourceLocationInventories.splice(r,1)},function(e){alert(e.data.err)})},e.saveDeployment=function(){e.deployment.ResourceLocationID?s():i()},e.addResources=function(o){delete o.ResourceLocationInventoryID,o.SourceLocationID=o.ResourceLocationID,o.ResourceLocationID=e.deployment.ResourceLocationID;var t=JSON.stringify(o),n=a({method:"POST",url:"/api/resourcelocationinventory",async:!0,headers:{"Content-Type":"application/json"},data:t});n.then(function(t){o.ResourceLocationInventoryID=t.data.json.ResourceLocationInventoryID,e.deployment.ResourceLocationInventories.push(o),e.showDistributionCenters=!1},function(e){console.log(e.data),alert("error: "+e.data.err)})},e.getResourceIcon=function(e){var o=e.ResourceType.Description;return"Water"==o?"style/images/Water-Diamond-Blue.png":"First Aid"==o?"style/images/First Aid-Diamond-Blue.png":"Shelter"==o?"style/images/Shelter-Diamond-Blue.png":"Evacuation"==o?"style/images/Evacuation-Diamond-Blue.png":"Medicine"==o?"style/images/Medicine-Diamond-Blue.png":"style/images/Food-Diamond-Blue.png"},e.toggleDistributionCenters=function(){e.showDistributionCenters=!e.showDistributionCenters}}]),angular.module("helpNow").controller("EventListCtrl",["$scope","$location",function(e,o){function t(){n&&e.events&&angular.forEach(e.events,function(t){var r=L.icon({iconUrl:e.getMapEventIcon(t.EventType.Description),iconSize:[43,44]}),a=L.marker([t.EventLocations[0].LAT,t.EventLocations[0].LONG],{icon:r});a.on("click",function(){e.$apply(function(){e.isLoggedIn?o.url("org_event/"+t.EventID):o.url("event_map/"+t.EventID)})}),a.addTo(n)})}var n;e.setTitle("Worldwide Events"),e.user=e.getCurrentUser(),null==e.user||0==e.user?e.isLoggedIn=!1:e.isLoggedIn=!0,e.getMapEventIcon=function(e){return"Flood"==e?"style/images/Flood-Circle-Red.png":"Tsunami"==e?"style/images/Tsunami-Circle-Red.png":"style/images/Earthquake-Circle-Red.png"},e.setCurrentView("events"),e.$on("EventDataLoaded",function(){t()}),e.initMap=function(e){n=e,t()}}]),angular.module("helpNow").controller("EventMapCtrl",["$scope","$http","$routeParams","$resource",function(e,o,t,n){function r(){"Current"==e.locationPref.value?navigator.geolocation&&navigator.geolocation.getCurrentPosition(a):(d.removeLayer(e.locationOutline),e.helpRequest.LAT="",e.helpRequest.LONG="",e.digest())}function a(o){e.helpRequest.LAT=o.coords.latitude,e.helpRequest.LONG=o.coords.longitude,void 0!==e.locationOutline&&d.removeLayer(e.locationOutline),e.locationOutline=L.circle([o.coords.latitude,o.coords.longitude],e.overlayRadius,{color:"#00ff00",opacity:1,fillOpacity:.7}).addTo(d),e.$digest()}function i(){var o=e.needFlags;return o.showMedical=!1,o.showShelter=!1,o.showFood=!1,o.showWater=!1,o.showEvacuation=!1,o.showMedicine=!1,!1}function s(){if(d&&e.events){for(var o=0;o<g.length;o++){var t=g[o];d.removeLayer(t)}g=[],e.showLocationMarkers&&e.buildLocationMarkers(e.locations,g,e.filterFlags),angular.forEach(g,function(e){d.addLayer(e)})}}function c(){e.requestsResource.get({eventID:e.eventID},function(o){e.requests=o.json.requests,e.locations=o.json.locations,s()})}function u(){e.urgencyResource.get({},function(o){e.urgencyList=o.json,e.selectedUrgency=e.urgencyList[0],e.helpRequest.RequestUrgencyID=e.selectedUrgency.RequestUrgencyID})}function l(){var t=JSON.stringify(e.helpRequest),n=o({method:"POST",url:"/api/resourcerequest",async:!0,headers:{"Content-Type":"application/json"},data:t});n.then(function(e){},function(o){alert("Error: "),e.hasSubmissionError=!0})}var d,g=[];e.setCurrentView("event-map"),e.requestsResource=n("/api/event/mapitems/:eventID"),e.urgencyResource=n("/api/requesturgency"),e.needRequestResource=n("/api/resourcerequest"),e.helpRequest={EventID:"",RequestStateID:"1",Notes:"Reported from App",AreaSize:"0.25 km",UnitOfMeasure:"",Quantity:""},e.eventID=1*t.eventID,e.events&&(e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),c(),u()),e.requests=[],e.overlayRadius=250,e.radiusRawVal=.25,e.sliderLabel="0.25 km",e.isMetric=!0,e.showFilters=!1,e.showEventDetails=!0,e.showHelp=!1,e.showNeeds=!1,e.filterFlags={showMedical:!0,showShelter:!0,showFood:!0,showWater:!0,showClothing:!0,showEvacuation:!0,showMedicine:!0},e.needFlags={showMedical:!1,showShelter:!1,showFood:!1,showWater:!1,showClothing:!1,showEvacuation:!1,showMedicine:!1},e.showLocationMarkers=!0,e.locationPref={value:"Current"},e.getLocation=function(){r()},e.centerMapToLongLat=function(e,o){d&&(d.setZoom(13),d.panTo(new L.LatLng(e,o)))},e.getSelectedUrgency=function(){e.helpRequest.RequestUrgencyID=e.selectedUrgency.RequestUrgencyID},e.showValue=function(){0==e.radiusRawVal&&(e.radiusRawVal=.05),e.isMetric?(e.overlayRadius=1e3*e.radiusRawVal,e.sliderLabel=e.radiusRawVal+" km"):(e.overlayRadius=1e3*e.radiusRawVal,e.sliderLabel=e.radiusRawVal+" mi"),e.helpRequest.AreaSize=e.sliderLabel,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)},e.changeUnits=function(){e.isMetric?(e.sliderLabel=e.radiusRawVal+" km",e.overlayRadius=e.overlayRadius/.62137119,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)):(e.sliderLabel=e.radiusRawVal+" mi",e.overlayRadius=.62137119*e.overlayRadius,void 0!==e.locationOutline&&e.locationOutline.setRadius(e.overlayRadius)),e.helpRequest.AreaSize=e.sliderLabel},e.$on("EventDataLoaded",function(){e.event=e.getEvent(e.eventID),c(),u(),i(),s()}),e.toggleButtonClass=function(o){var t=e[o];return t?"btn btn-toggle active":"btn btn-toggle"},e.toggleButton=function(o){var t=e.filterFlags;return t[o]=!t[o],s(),!1},e.toggleFilterClass=function(o){var t=e.filterFlags,n=t[o];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleNeedsClass=function(o){var t=e.needFlags,n=t[o];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleNeed=function(o){var t=e.needFlags;return t[o]=!t[o],!1},e.initMap=function(o){d=o,d.on("click",function(o){"Other"==e.locationPref.value&&(void 0!==e.locationOutline&&d.removeLayer(e.locationOutline),e.locationOutline=L.circle(o.latlng,e.overlayRadius,{color:"#00ff00",opacity:1,fillOpacity:.7}).addTo(d),e.helpRequest.LAT=o.latlng.lat.toFixed(3),e.helpRequest.LONG=o.latlng.lng.toFixed(3),e.$digest())}),s()},e.filterButtonClass=function(){return e.showFilters?"glyphicon glyphicon-eye-close":"glyphicon glyphicon-eye-open"},e.filterButtonText=function(){return e.showFilters?"Hide":"Show"},e.toggleFilters=function(){return e.showFilters=!e.showFilters,!1},e.toggleHelp=function(){return e.showEventDetails=!e.showEventDetails,e.showHelp=!e.showHelp,r(),!1},e.toggleNeeds=function(){var o=!1;return e.showHelp&&("Other"!=e.locationPref.value||void 0!==e.helpRequest.LAT&&""!=e.helpRequest.LAT&&void 0!==e.helpRequest.LONG&&""!=e.helpRequest.LONG||(o=!0),void 0===e.helpRequest.AreaSize&&(o=!0),(void 0===e.helpRequest.Quantity||0==e.helpRequest.Quantity)&&(o=!0)),o?alert("Missing Required Field(s)"):(e.showHelp=!e.showHelp,e.showNeeds=!e.showNeeds),!1},e.validateNumber=function(e){var o=e||window.event,t=o.keyCode||o.which;return!o.shiftKey&&!o.altKey&&!o.ctrlKey&&t>=48&&57>=t||8==t||9==t||13==t||37==t||39==t||46==t||45==t?!1:(o.returnValue=!1,o.preventDefault&&o.preventDefault(),!0)},e.sendNeedRequest=function(){var o=!1,t=e.needFlags;if(e.showNeeds&&(t.showMedical||t.showShelter||t.showFood||t.showMedicine||t.showWater||t.showClothing||t.showEvacuation||(o=!0)),o)alert("Specify a Need");else{e.helpRequest.EventID=e.eventID;var n=e.helpRequest.AreaSize.split(" ");e.helpRequest.AreaSize=n[0],e.helpRequest.UnitOfMeasure=n[1],t.showMedicalNeed&&(e.helpRequest.ResourceTypeID="4",l()),t.showShelter&&(e.helpRequest.ResourceTypeID="3",l()),t.showFood&&(e.helpRequest.ResourceTypeID="1",l()),t.showMedicine&&(e.helpRequest.ResourceTypeID="6",l()),t.showWater&&(e.helpRequest.ResourceTypeID="2",l()),t.showClothing&&(e.helpRequest.ResourceTypeID="5",l()),t.showEvacuation&&(e.helpRequest.ResourceTypeID="7",l()),i(),d.removeLayer(e.locationOutline),e.showNeeds=!e.showNeeds,e.showEventDetails=!e.showEventDetails,e.hasSubmissionError||alert("Request(s) successfully submitted")}return!1}}]),angular.module("helpNow").controller("GovLoginCtrl",["$scope",function(e){e.setCurrentView("govs")}]),angular.module("helpNow").controller("IndLoginCtrl",["$scope",function(e){e.setCurrentView("inds")}]),angular.module("helpNow").controller("InventoryCtrl",["$scope","$http","$routeParams","ResourceLocation","ResourceLocationInventory","ResourceLocationTransport","$resource","$uibModal",function(e,o,t,n,r,a,i,s){function c(){null!==e.currentUser?e.resourceLocationResource.get({orgid:e.currentUser.OrganizationID},function(o){e.resourceLocations=o.json,e.$broadcast("ResourceLocationDataLoaded",{})}):(e.showResourceLocations=!1,m())}function u(){e.locationTypeResource.get({},function(o){e.resourceLocationTypes=o.json})}function l(){e.locationStatusResource.get({},function(o){e.resourceLocationStatuses=o.json})}function d(){e.transportTypeResource.get({},function(o){e.transportTypes=o.json})}function g(){e.resourceTypeResource.get({},function(o){e.resourceTypes=o.json})}function p(){e.resourceTypeUnitOfMeasureResource.get({},function(o){e.resourceTypeUnitOfMeasures=o.json})}function m(){if(y&&e.resourceLocations){for(var o=0;o<w.length;o++){var t=w[o];y.removeLayer(t)}w=[],h(w),angular.forEach(w,function(e){y.addLayer(e)})}}function h(o){angular.forEach(e.resourceLocations,function(e){var t=L.icon({iconUrl:"style/images/Resources-Box-Blue.png",iconSize:[60,60],iconAnchor:[30,30]}),n=f(e,t);o.push(n)})}function f(e,o){var t=L.marker([e.LAT,e.LONG],{icon:o});return t.id=e.ResourceLocationID,t.bindPopup(v(e)),t}function v(e){var o="<strong>"+e.Description+"</strong><br/>"+e.PrimaryPOCPhone+"<hr/>";return"undefined"!=typeof e.ResourceLocationInventories&&e.ResourceLocationInventories.forEach(function(e){o+=e.ResourceType.Description+": "+e.Quantity+" "+e.ResourceTypeUnitOfMeasure.Description+"<br/>"}),o}var y,w=[];e.setTitle("Inventory Management"),e.setCurrentView("inventory"),e.resourceLocationResource=i("/api/resourcelocation/dist-center/organization/:orgid",{orgid:"@orgid"}),e.locationTypeResource=i("/api/resourcelocationtype/",{}),e.locationStatusResource=i("/api/resourcelocationstatus/",{}),e.transportTypeResource=i("/api/transporttype/",{}),e.resourceTypeResource=i("/api/resourcetype/",{}),e.resourceTypeUnitOfMeasureResource=i("/api/resourcetypeunitofmeasure/",{}),e.currentResourceLocation=new n,e.currentResourceLocationInventory=new r,e.transportTypes=[],e.overlayRadius=250,e.radiusRawVal=.25,e.sliderLabel="0.25 km",e.isMetric=!0,e.showResourceLocations=!0,e.showLocationForm=!1,e.showTransportationOptionsForm=!1,e.showResourceLocation=!1,e.showResourceTypes=!1,e.editMode=!1,e.showAir=!1,e.showGround=!1,e.showWater=!1,e.resourcesFiltered=!1,e.resourceLocationInventoryEdit=!1,d(),u(),l(),c(),g(),p(),e.$on("ResourceLocationDataLoaded",function(){e.showLocationsDiv(),m()}),e.initMap=function(o){y=o,y.on("click",function(o){"Other"==e.locationPref.value&&(void 0!==e.locationOutline&&y.removeLayer(e.locationOutline),e.locationOutline=L.circle(o.latlng,e.overlayRadius,{color:"#00ff00",opacity:1,fillOpacity:.7}).addTo(y),e.currentResourceLocation.LAT=o.latlng.lat.toFixed(3),e.currentResourceLocation.LONG=o.latlng.lng.toFixed(3),e.$digest())}),m()},e.centerMapToLongLat=function(e,o){y&&(y.setZoom(12),y.panTo(new L.LatLng(e,o)))},e.resourceLocationClick=function(o,t,n){y&&(e.centerMapToLongLat(o,t),e.setCurrentResourceLocationByID(n),e.showResourceLocationDiv())},e.setCurrentResourceLocationByID=function(o){e.resourceLocations.forEach(function(t){t.ResourceLocationID==o&&(e.currentResourceLocation=t)})},e.setTransportationType=function(o){var t=e.currentResourceLocation.ResourceLocationTransports.map(function(e){return e.TransportTypeID}).indexOf(o);if(-1!=t)e.currentResourceLocation.ResourceLocationTransports.splice(t,1);else{var n=new a;n.TransportTypeID=o,n.ResourceLocationID=e.currentResourceLocation.ResourceLocationID,e.currentResourceLocation.ResourceLocationTransports.push(n)}return!1},e.setResourceLocationType=function(o){return e.currentResourceLocation.ResourceLocationType=o,e.currentResourceLocation.ResourceLocationTypeID=o.ResourceLocationTypeID,!1},e.setDefaultResourceLocationType=function(){var o=e.resourceLocationTypes.map(function(e){return e.Description}).indexOf("Distribution Center");return e.resourceLocationTypes[o]},e.setDefaultResourceLocationStatus=function(){var o=e.resourceLocationStatuses.map(function(e){return e.Status}).indexOf("Active");return e.resourceLocationStatuses[o]},e.showNewEditForm=function(o){if(e.showAir=!1,e.showGround=!1,e.showWater=!1,o){e.editMode=!0;var t=e.resourceLocations.map(function(e){return e.ResourceLocationID}).indexOf(o);e.currentResourceLocation=e.resourceLocations[t],e.currentResourceLocation.ResourceLocationTransports.forEach(function(o){var t=e.transportTypes.map(function(e){return e.TransportTypeID}).indexOf(o.TransportTypeID),n=e.transportTypes[t];"Ground"==n.Description?e.showGround=!0:"Air"==n.Description?e.showAir=!0:"Water"==n.Description&&(e.showWater=!0)})}else{e.editMode=!1;var r=new n;r.ResourceLocationTransports=[],r.OrganizationID=e.currentUser.OrganizationID;var a=e.setDefaultResourceLocationType();r.ResourceLocationType=a,r.ResourceLocationTypeID=a.ResourceLocationTypeID;var i=e.setDefaultResourceLocationStatus();r.ResourceLocationStatus=i,r.ResourceLocationStatusID=i.ResourceLocationStatusID,e.currentResourceLocation=r}return e.showLocationDiv(),!1},e.showLocationDiv=function(){return e.showLocationForm=!0,e.showResourceLocation=!1,e.showResourceLocations=!1,e.showTransportationOptionsForm=!1,e.showResourceTypes=!1,!1},e.showTransportationDiv=function(){return e.showLocationForm=!1,e.showResourceLocation=!1,e.showResourceLocations=!1,e.showTransportationOptionsForm=!0,e.showResourceTypes=!1,!1},e.showLocationsDiv=function(){return e.showLocationForm=!1,e.showResourceLocation=!1,e.showResourceLocations=!0,e.showTransportationOptionsForm=!1,e.showResourceTypes=!1,!1},e.showResourceLocationDiv=function(){return e.showLocationForm=!1,e.showResourceLocations=!1,e.showResourceLocation=!0,e.showTransportationOptionsForm=!1,e.showResourceTypes=!1,!1},e.showResourceTypesDiv=function(){return e.showLocationForm=!1,e.showResourceLocations=!1,e.showResourceLocation=!1,e.showTransportationOptionsForm=!1,e.showResourceTypes=!0,!1},e.showTransport=function(o){return"Ground"==o?e.showGround:"Air"==o?e.showAir:"Water"==o?e.showWater:!1},e.showTransparentTransport=function(o){return"Ground"==o?!e.showGround:"Air"==o?!e.showAir:"Water"==o?!e.showWater:!1},e.toggleTransport=function(o){var t=e.transportTypes.map(function(e){return e.TransportTypeID}).indexOf(o),n=e.transportTypes[t];return"Ground"==n.Description?(e.showGround=!e.showGround,e.setTransportationType(o)):"Air"==n.Description?(e.showAir=!e.showAir,e.setTransportationType(o)):"Water"==n.Description&&(e.showWater=!e.showWater,e.setTransportationType(o)),!1},e.showResourceLocationInventoryEditForm=function(o){return e.currentResourceLocationInventory=o,e.resourceLocationInventoryEdit=!0,e.showResourceTypesDiv(),e.setResourceLocationInventoryType(o.ResourceType),!1},e.showResourceLocationInventoryNewForm=function(){e.resourceLocationInventoryEdit=!1,e.resourcesFiltered=!1,e.resourceTypesFiltered=e.resourceTypes;var o=new r;return o.ResourceLocationID=e.currentResourceLocation.ResourceLocationID,e.currentResourceLocationInventory=o,e.showResourceTypesDiv(),!1},e.setResourceLocationInventoryType=function(o){e.resourcesFiltered=!0,e.currentResourceLocationInventory.ResourceTypeID=o.ResourceTypeID,e.currentResourceLocationInventory.ResourceType=o,e.resourceTypesFiltered=e.resourceTypes.filter(function(e){return e.ResourceTypeID==o.ResourceTypeID}),e.resourceTypeUnitOfMeasuresFiltered=e.resourceTypeUnitOfMeasures.filter(function(e){return e.ResourceTypeID==o.ResourceTypeID});var t=e.currentResourceLocationInventory.ResourceTypeUnitOfMeasure;return t?e.setResourceTypeUnitOfMeasure(t):e.setResourceTypeUnitOfMeasure(e.resourceTypeUnitOfMeasuresFiltered[0]),!1},e.clearResourceTypeFiltered=function(){e.resourcesFiltered=!1,e.resourceTypesFiltered=e.resourceTypes},e.setResourceTypeUnitOfMeasure=function(o){e.currentResourceTypeUnitOfMeasure=o,e.currentResourceLocationInventory.ResourceTypeUnitOfMeasureID=o.ResourceTypeUnitOfMeasureID,e.currentResourceLocationInventory.ResourceTypeUnitOfMeasure=o},e.modalDeleteResourceLocationInventory=function(){e.modalInstance=s.open({templateUrl:"/inventory/resource-inventory-modal-delete.html",scope:e,size:"med"})},e.deleteResourceLocationInventory=function(){r["delete"]({id:e.currentResourceLocationInventory.ResourceLocationInventoryID}).$promise.then(function(o){var t=e.currentResourceLocation.ResourceLocationInventories.map(function(e){return e.ResourceLocationInventoryID}).indexOf(e.currentResourceLocationInventory.ResourceLocationInventoryID);e.currentResourceLocation.ResourceLocationInventories.splice(t,1),e.showResourceLocationDiv()})},e.modalDeleteResourceLocation=function(){e.modalInstance=s.open({templateUrl:"/inventory/resource-location-modal-delete.html",scope:e,size:"med"})},e.deleteResourceLocation=function(){n["delete"]({id:e.currentResourceLocation.ResourceLocationID}).$promise.then(function(o){var t=e.resourceLocations.map(function(e){return e.ResourceLocationID}).indexOf(e.currentResourceLocation.ResourceLocationID);e.resourceLocations.splice(t,1),e.currentResourceLocation=new n,e.showLocationsDiv(),m()})},e.saveResourceLocation=function(){return e.editMode?e.updateResourceLocation():e.saveNewResourceLocation(),!1},e.saveNewResourceLocation=function(){n.save(e.currentResourceLocation).$promise.then(function(e){c()})},e.updateResourceLocation=function(){n.update({id:e.currentResourceLocation.ResourceLocationID},e.currentResourceLocation).$promise.then(function(e){c()})},e.saveResourceLocationInventory=function(){return e.resourceLocationInventoryEdit?e.updateResourceLocationInventory():e.saveNewResourceLocationInventory(),!1},e.saveNewResourceLocationInventory=function(){return r.save(e.currentResourceLocationInventory).$promise.then(function(o){e.currentResourceLocation.ResourceLocationInventories.push(e.currentResourceLocationInventory),e.showResourceLocationDiv()}),!1},e.updateResourceLocationInventory=function(){return r.update({id:e.currentResourceLocationInventory.ResourceLocationInventoryID},e.currentResourceLocationInventory).$promise.then(function(o){e.showResourceLocationDiv()}),!1},e.validateNumber=function(e){var o=e||window.event,t=o.keyCode||o.which;return!o.shiftKey&&!o.altKey&&!o.ctrlKey&&t>=48&&57>=t||8==t||9==t||13==t||37==t||39==t||46==t||45==t?!1:(o.returnValue=!1,o.preventDefault&&o.preventDefault(),!0)}}]),angular.module("helpNow").controller("LoginCtrl",["$scope","$http","$location","$routeParams","$resource",function(e,o,t,n,r){function a(){var n="username="+e.userCreds.username+"&password="+e.userCreds.password,r=o({method:"POST",url:"/auth/login",async:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:n});r.then(function(o){if(e.users=o.data.json,e.currentUser=e.users[0],void 0===e.currentUser)alert("Incorrect username or password. Please try again.");else{var n={AccountID:e.currentUser.AccountID,FirstName:e.currentUser.FirstName,LastName:e.currentUser.LastName,OrganizationID:e.currentUser.Organization.OrganizationID,OrganizationTypeID:e.currentUser.Organization.OrganizationTypeID,OrganizationName:e.currentUser.Organization.Name};e.setCurrentUser(n),e.setCurrentOrg(e.currentUser.Organization),sessionStorage.setItem("user",JSON.stringify(n)),e.$broadcast("CurrentUserLoaded",{}),t.path(e.previousPath)}},function(e){alert("Incorrect username or password. Please try again.")})}e.setCurrentView("login"),e.setTitle("Login"),e.validateUser=function(){void 0===e.userCreds.username||void 0===e.userCreds.password?alert("Missing Username or Password"):a()}}]),angular.module("helpNow").controller("ManageCtrl",["$scope","$location","$resource","Invitation","$uibModal","Account",function(e,o,t,n,r,a){e.invitesResource=t("/api/inviterequest/organizationinvites/:accountid",{accountid:e.currentUser.AccountID}),e.orgResource=t("/api/organization/:id",{id:e.currentOrg.OrganizationID}),e.setTitle("Organization Management"),e.loadInvites=function(){e.invitesResource.get({},function(o){e.invites=o.json,e.$broadcast("InviteDataLoaded",{})}),e.orgResource.get({},function(o){e.org=o.json[0],e.$broadcast("OrgLoaded",{})})},e.loadInvites(),e.deleteInvite=function(t){e.modalInstance=r.open({templateUrl:"/manage/invite-modal-delete.html",controller:function(e){this.invitation=t,this.Invitation=n,e.deleteInvite=function(e){n["delete"]({inviteid:e.InviteID}),o.path("/manage")}},controllerAs:"model"})},e.teamResource=t("/api/account/organizationmembers/:accountid",{accountid:e.currentUser.AccountID}),e.loadTeam=function(){e.teamResource.get({},function(o){e.team=o.json,e.$broadcast("TeamDataLoaded",{})})},e.loadTeam(),e.deleteTeamMember=function(t){e.modalInstance=r.open({templateUrl:"/manage/teammember-modal-delete.html",controller:function(e){this.teamMember=t,this.Account=a,e.deleteMember=function(){a["delete"]({id:t.AccountID}),o.path("/manage")}},controllerAs:"model"})},e.enterAddress=function(){o.path("/org_address/"+e.currentOrg.OrganizationID)},e.go=function(e){o.path(e)}}]),angular.module("helpNow").controller("OrgAddressCtrl",["$scope","$http","$location","Organization","$routeParams","$resource",function(e,o,t,n,r,a){function i(){e.loadOrg()}function s(){var n=JSON.stringify(e.orgAddress),r=o({method:"PUT",url:"/api/address/"+e.org.AddressID,async:!0,headers:{"Content-Type":"application/json"},data:n});r.then(function(e){alert(JSON.stringify(e)),alert("Address Successfully Submitted"),t.path("#")},function(e){alert(JSON.stringify(e))})}function c(){var t=JSON.stringify(e.orgAddress),n=o({method:"POST",url:"/api/address",async:!0,headers:{"Content-Type":"application/json"},data:t});n.then(function(e){alert("Address Successfully Submitted"),u(e.data.json.AddressID)},function(e){alert("Error: ")})}function u(n){alert(JSON.stringify(e.org)),e.org.AddressID=n;var r=JSON.stringify(e.org);alert(r);var a=o({method:"PUT",url:"/api/organization/"+e.org.OrganizationID,async:!0,headers:{"Content-Type":"application/json"},data:r});a.then(function(e){alert(JSON.stringify(e)),t.path("#/manage")},function(e){alert(JSON.stringify(e))})}e.setCurrentView("org-address"),e.setTitle("Organization Address"),e.addressResource=a("/api/address/:id"),e.orgResource=a("/api/organization/:id"),e.orgID=1*r.orgID,e.loadOrg=function(){e.orgResource.get({id:e.orgID},function(o){e.org=o.json[0],e.loadAddress()})},e.loadAddress=function(){e.org.AddressID&&e.addressResource.get({id:e.org.AddressID},function(o){e.orgAddress=o.json[0],o.json[0]&&(e.hasAddress=!0)})},i(),e.submitOrgAddress=function(){e.hasAddress?s():c()}}]),angular.module("helpNow").controller("OrgEventCtrl",["$scope","$routeParams","$resource","$sce","$location",function(e,o,t,n,r){function a(){e.showFilters=!1,e.showFindPanel=!1,e.showFindResults=!1,e.showMappingError=!1,e.showDeployPanel=!1,e.showDeploymentPanel=!1}function i(){"Current"==e.locationPref.value?navigator.geolocation&&navigator.geolocation.getCurrentPosition(s):(e.mappingLoc.LAT=null,e.mappingLoc.LONG=null,
u())}function s(o){e.mappingLoc.LAT=o.coords.latitude,e.mappingLoc.LONG=o.coords.longitude,u(),e.$digest()}function c(){e.locationOutline&&I.removeLayer(e.locationOutline)}function u(){c(),e.showFindPanel&&e.mappingLoc.LAT&&e.mappingLoc.LONG?e.locationOutline=L.circle([e.mappingLoc.LAT,e.mappingLoc.LONG],250,{color:"#00ff00",opacity:1,fillOpacity:.7}).addTo(I):e.showDeployPanel&&e.deployment.LAT&&e.deployment.LONG&&(e.locationOutline=L.circle([e.deployment.LAT,e.deployment.LONG],250,{color:"#00ff00",opacity:1,fillOpacity:.7}).addTo(I))}function l(e){return"Water"==e?"style/images/markers/dot-blue.png":"First Aid"==e?"style/images/markers/dot-red.png":"Shelter"==e?"style/images/markers/dot-orange.png":"Evacuation"==e?"style/images/markers/dot-purple.png":"Medicine"==e?"style/images/markers/dot-cyan.png":"Clothing"==e?"style/images/markers/dot-yellow.png":"style/images/markers/dot-green.png"}function d(e){return"Water"==e?"style/images/Water-Circle-Red.png":"First Aid"==e?"style/images/First Aid-Circle-Red.png":"Shelter"==e?"style/images/Shelter-Circle-Red.png":"Clothing"==e?"style/images/Clothing-Circle-Red.png":"Evacuation"==e?"style/images/Evacuation-Circle-Red.png":"Medicine"==e?"style/images/Medicine-Circle-Red.png":"style/images/Food-Circle-Red.png"}function g(e){angular.forEach(e,function(e){var o=L.icon({iconUrl:l(e.ResourceType.Description),iconSize:[27,27],iconAnchor:[13,41],popupAnchor:[0,-20]}),t=L.marker([e.LAT,e.LONG],{icon:o});t.bindPopup("<strong>"+e.ResourceType.Description+" ("+e.Quantity+")</strong><br/>"+e.Notes),T.push(t)})}function p(){if(e.requestClusters){var o=e.requestClusters.filter(function(o){var t=o.ResourceType.Description;return e.shouldDisplayMarker(t,e.filterFlags)});angular.forEach(o,function(e){var o=L.icon({iconUrl:d(e.ResourceType.Description),iconSize:[50,50],iconAnchor:[25,25]}),t=L.marker([e.LAT,e.LONG],{icon:o});t.bindPopup("<strong>"+e.ResourceType.Description+"</strong><br/>"+e.Notes),T.push(t)})}}function m(e){var o={radius:100,maxOpacity:.5,scaleRadius:!1,useLocalExtrema:!0,latField:"LAT",lngField:"LONG",valueField:"Quantity"},t=new HeatmapOverlay(o),n={data:e};t.setData(n),T.push(t)}function h(){if(e.distributionCenters){var o=e.distributionCenters.filter(function(o){return e.shouldDisplayLocationMarker(o,e.filterFlags)});angular.forEach(o,function(o){var t=o.OrganizationID==e.currentOrg.OrganizationID,n=t?"style/images/Distribution-Center-DBox-Blue.png":"style/images/Distribution-Center-Box-Blue.png",r=L.icon({iconUrl:n,iconSize:[60,60],iconAnchor:[30,30]}),a=e.buildLocationMarker(o,r);T.push(a)})}}function f(){if(I&&e.events){for(var o=I.getZoom(),t=0;t<T.length;t++){var n=T[t];I.removeLayer(n)}T=[];var r=e.requests.filter(function(o){var t=o.ResourceType.Description;return e.shouldDisplayMarker(t,e.filterFlags)});e.showHeatmap&&m(r),e.showNeedsMarkers&&o>7&&g(r),e.showClusters&&p(),e.showLocationMarkers&&e.buildLocationMarkers(e.locations,T,e.filterFlags,v),e.showDistCenterMarkers&&h(),angular.forEach(T,function(e){I.addLayer(e)})}}function v(o){a(),e.deployment=o,e.showDeploymentPanel=!0}function y(){e.requestsResource.get({eventID:e.eventID},function(o){e.requests=o.json.requests,e.locations=o.json.locations,e.requestClusters=o.json.requestClusters,e.distributionCenters=o.json.distributionCenters,f()})}function w(e){return e*(Math.PI/180)}function R(e,o,t,n){var r=6371,a=w(t-e),i=w(n-o),s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(w(e))*Math.cos(w(t))*Math.sin(i/2)*Math.sin(i/2),c=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return r*c}function D(){var o=0,t=Number.MAX_VALUE,n=e.distributionCenters.filter(function(o){return alert(JSON.stringify(e.currentOrg)),1==e.currentOrg.OrganizationTypeID?e.shouldDisplayLocationMarker(o,e.matchingFlags):e.shouldDisplayLocationMarker(o,e.matchingFlags)&&o.OrganizationID==e.currentOrg.OrganizationID}),r=n.map(function(n){var r=R(n.LAT,n.LONG,e.mappingLoc.LAT,e.mappingLoc.LONG);return r>=o&&(o=r),t>=r&&(t=r),{center:n,dist:r.toFixed(3)}}),a=r.map(function(e){var n=(e.dist-t)/(o-t);return e.score=n,e});return a.sort(function(e,o){return e.score-o.score}),a.length>3&&(a=a.slice(0,3)),e.hasMatches=a.length>0,a}var I,T=[];e.setCurrentView("org-events"),e.requestsResource=t("/api/event/mapitems/:eventID"),e.eventID=1*o.eventID,e.events&&(e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),y()),e.requests=[],e.showFilters=!1,e.showFindPanel=!1,e.showFindResults=!1,e.showMappingError=!1,e.showDeployPanel=!1,e.showDeploymentPanel=!1,e.showHeatmap=!0,e.showClusters=!0,e.showNeedsMarkers=!1,e.showLocationMarkers=!1,e.showDistCenterMarkers=!1,e.filterFlags={showMedical:!0,showShelter:!0,showFood:!0,showWater:!0,showClothing:!0,showEvacuation:!0,showMedicine:!0},e.matchingFlags={showMedical:!1,showShelter:!1,showFood:!1,showWater:!1,showClothing:!1,showEvacuation:!1,showMedicine:!1},e.mappingLoc={},e.deployment={},e.locationPref={value:"Current"},e.getLocation=function(){i()},e.getMatchResources=function(){var o=[],t=e.matchingFlags;return t.showMedical&&o.push("First Aid"),t.showShelter&&o.push("Shelter"),t.showFood&&o.push("Food"),t.showWater&&o.push("Water"),t.showClothing&&o.push("Clothing"),t.showEvacuation&&o.push("Evacuation"),t.showMedicine&&o.push("Medicine"),o.join(", ")},e.$on("EventDataLoaded",function(){e.event=e.getEvent(e.eventID),e.setTitle(e.event.EventLocations[0].Description,e.getEventIcon(e.event.EventType.Description)),y(),f()}),e.centerMapToLongLat=function(e,o){I&&(I.setZoom(13),I.panTo(new L.LatLng(e,o)))},e.toggleButtonClass=function(o){var t=e[o];return t?"btn btn-toggle active":"btn btn-toggle"},e.toggleButton=function(o){return e[o]=!e[o],f(),!1},e.toggleResourceFilter=function(o){var t=e.filterFlags;return t[o]=!t[o],f(),!1},e.toggleResourceButtonClass=function(o){var t=e.filterFlags,n=t[o];return n?"btn btn-toggle active":"btn btn-toggle"},e.toggleMatchingFilter=function(o){var t=e.matchingFlags;return t[o]=!t[o],f(),!1},e.toggleMatchingButtonClass=function(o){var t=e.matchingFlags,n=t[o];return n?"btn btn-toggle active":"btn btn-toggle"},e.getCleanLocationText=function(o){return n.trustAsHtml(e.buildLocationDetails(o))},e.initMap=function(o){I=o,I.on("zoomend",function(){f()}),I.on("click",function(o){e.showFindPanel&&!e.showFindResults&&"Other"==e.locationPref.value?(e.mappingLoc.LAT=o.latlng.lat.toFixed(3),e.mappingLoc.LONG=o.latlng.lng.toFixed(3),u(),e.$digest()):e.showDeployPanel&&(e.deployment.LAT=o.latlng.lat.toFixed(3),e.deployment.LONG=o.latlng.lng.toFixed(3),u(),e.$digest())}),f()},e.filterButtonText=function(){return e.showFilters?"Hide":"Show"},e.toggleFilters=function(){e.showFilters=!e.showFilters},e.toggleFindPanel=function(){e.showFindPanel=!e.showFindPanel,e.showFindPanel?(e.showDistCenterMarkers=!0,i(),f()):c()},e.toggleDeployPanel=function(){e.showDeployPanel=!e.showDeployPanel,e.showDeployPanel&&(i(),e.showDistCenterMarkers=!0,f())},e.findMatches=function(){return e.showMappingError=!1,e.mappingLoc.LAT&&e.mappingLoc.LONG&&0!=e.getMatchResources().length?(e.matches=D(),e.showFindResults=!0,!1):(e.showMappingError=!0,!1)},e.showLocation=function(e,o){I.setView([e,o],I.getZoom())},e.backToFind=function(){return e.showFindResults=!1,!1},e.closeDeploymentPanel=function(){e.showDeploymentPanel=!1},e.panelIsOpen=function(){return e.showFindPanel||e.showFilters||e.showDeployPanel||e.showDeploymentPanel},e.createDeployment=function(){var o="create_deployment/"+e.eventID+"/"+e.deployment.LAT+"/"+e.deployment.LONG;r.path(o)},e.modifyDeployment=function(){var o="modify_deployment/"+e.deployment.ResourceLocationID;r.path(o)},e.setCurrentView("org-event")}]),angular.module("helpNow").controller("OrganizationAddCtrl",["$scope","$resource","$routeParams","Organization","$location",function(e,o,t,n,r){e.orgTypeID=1*t.orgTypeID,e.newOrg=new n,e.newOrg.OrganizationTypeID=e.orgTypeID,e.orgType=1==e.orgTypeID?"Government":"Organization",e.setTitle("Create "+e.orgType),e.go=function(e){r.path(e)},e.addOrg=function(e){n.save(e).$promise.then(function(e){r.path("/administration")},function(e){alert("Error: ")})},e.enterAddress=function(e){n.save(e).$promise.then(function(e){var o=e.json[0];r.path("/org_address/"+o.OrganizationID)},function(e){alert("Error: ")})}}]),angular.module("helpNow").controller("RegAccountCtrl",["$scope","$http","$location","$routeParams","$resource",function(e,o,t,n,r){function a(){var n=JSON.stringify(e.userAccount),r=o({method:"POST",url:"/api/account",async:!0,headers:{"Content-Type":"application/json"},data:n});r.then(function(e){alert("Account Successfully Created"),t.path("#")},function(e){alert("Error: ")})}e.setCurrentView("reg-account"),e.setTitle("Register an Account"),e.showUsername=!0,e.showUser=!1,e.userAccount={OrganizationGroupID:1,Active:!0,AccountRoleID:3,CreateDate:new Date},e.showUserForm=function(){var o=!1;void 0===e.userAccount.Username||void 0===e.userAccount.Password||void 0===e.confirmedPassword?(alert("Missing field(s)"),o=!0):e.userAccount.Password!=e.confirmedPassword&&(alert("Passwords do not match"),o=!0),o||(e.showUser=!0,e.showUsername=!1)},e.showUsernameForm=function(){e.showUser=!1,e.showUsername=!0},e.submitUserReg=function(){var o=!1;(void 0===e.userAccount.FirstName||void 0===e.userAccount.LastName||void 0===e.userAccount.Email)&&(alert("Missing field(s)"),o=!0),o||a()}}]),angular.module("helpNow").controller("RegulationAddCtrl",["$scope","$resource","$routeParams","Regulation","$location",function(e,o,t,n,r){e.newReg=new n,e.newReg.OrganizationID=e.currentOrg.OrganizationID,e.go=function(e){r.path(e)},e.addRegulation=function(e){console.log(e.Narrative),console.log(e.Summary),n.save(e),r.path("/regulations")}}]),angular.module("helpNow").controller("RegulationDetailCtrl",["$scope","$resource","$routeParams","Regulation","$location",function(e,o,t,n,r){e.regulationResource=n.get({id:t.organizationRegulationsID},function(o){e.regulation=o.json,e.$broadcast("RegulationDataLoaded",{})}),e.go=function(e){r.path(e)}}]),angular.module("helpNow").controller("RegulationEditCtrl",["$scope","$resource","$routeParams","Regulation","$location","$uibModal",function(e,o,t,n,r,a){e.regulationResource=n.get({id:t.organizationRegulationsID},function(o){e.editRegulations=o.json,e.editReg=e.editRegulations[0],e.$broadcast("RegulationDataLoaded",{})}),e.updateRegulation=function(e){n.update({id:t.organizationRegulationsID},e),r.path("/regulations")},e.deleteRegulation=function(o){e.modalInstance=a.open({templateUrl:"/manage/regulations-modal-delete.html",controller:function(e){this.regulation=o,this.Regulation=n,e.deleteReg=function(){console.log("regulation.OrganizationRegulationsID"+o.OrganizationRegulationsID),n["delete"]({id:o.OrganizationRegulationsID}),r.path("/regulations")}},controllerAs:"model"})},e.go=function(e){r.path(e)}}]),angular.module("helpNow").controller("RegulationsCtrl",["$scope","$resource","$location",function(e,o,t){e.regulationsResource=o("api/organizationregulation/account/:accountId",{accountId:e.currentUser.AccountID}),e.loadRegulations=function(){e.regulationsResource.get({},function(o){e.regulations=o.json,e.$broadcast("RegulationDataLoaded",{})})},e.loadRegulations(),e.setCurrentView("regulations"),e.$on("RegulationDataLoaded",function(){}),e.go=function(e){t.path(e)}}]),angular.module("helpNow").controller("RootCtrl",["$scope","$location","$http","$resource",function(e,o,t,n){var r="Eng",a="";e.eventsResource=n("/api/event"),e.currentUser=JSON.parse(sessionStorage.getItem("user")),e.currentOrg=JSON.parse(sessionStorage.getItem("user")),e.title="Worldwide Events",e.loadEvents=function(){e.eventsResource.get({},function(o){e.events=o.json,e.$broadcast("EventDataLoaded",{})})},e.getShowLogin=function(){return 0==e.title.indexOf("Login")?!1:e.currentUser?!1:!0},e.getEventIcon=function(e){return"Flood"==e?"style/images/flood.png":"Tsunami"==e?"style/images/Tsunami.png":"style/images/earthquake.png"},e.getMenuClass=function(e){return e==a?"active":""},e.setCurrentView=function(e){a=e},e.setTitle=function(o,t){e.title=o,e.imageSrc=t},e.setCurrentUser=function(o){e.currentUser=o},e.getCurrentUser=function(){return e.currentUser},e.setCurrentOrg=function(o){e.currentOrg=o},e.setCurrentLanguage=function(o){r=o,"Ben"==o?t.get("i18n/text-BEN.json").success(function(o){e.text=o}).error(function(e){console.log("setCurrentLanguage: "+e)}):t.get("i18n/text-ENG.json").success(function(o){e.text=o}).error(function(e){console.log("setCurrentLanguage: "+e)})},e.getLanguageClass=function(e){return r==e?"active":""},e.setCurrentLanguage("Eng"),e.getResourcesForEvent=function(o){for(var t=[],n=0;n<e.resources.length;n++){var r=e.resources[n];r.eventID==o&&t.push(r)}return t.length>0?t:{}},e.getEvent=function(o){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(n.EventID==o)return n}return{}},e.getLocationIcon=function(o){var t=o.ResourceLocationInventories,n=e.currentOrg&&o.OrganizationID==e.currentOrg.OrganizationID;if(t.length>1)return n?"style/images/Resources-DBox-Blue.png":"style/images/Resources-Box-Blue.png";var r=n?"DDiamond-Blue":"Diamond-Blue",a=t[0].ResourceType.Description;return"Water"==a?"style/images/Water-"+r+".png":"First Aid"==a?"style/images/First Aid-"+r+".png":"Shelter"==a?"style/images/Shelter-"+r+".png":"Evacuation"==a?"style/images/Evacuation-"+r+".png":"Clothing"==a?"style/images/Clothing-"+r+".png":"Medicine"==a?"style/images/Medicine-"+r+".png":"style/images/Food-"+r+".png"},e.buildLocationDetails=function(e){var o="<strong>"+e.Organization.Name+"</strong><br/>"+e.PrimaryPOCName+"<br/>"+e.PrimaryPOCPhone+"<hr/>";return e.ResourceLocationInventories.forEach(function(e){o+=e.ResourceType.Description+": "+e.Quantity+" "+e.ResourceTypeUnitOfMeasure.Description+"<br/>"}),o},e.buildLocationMarker=function(o,t,n){var r=L.marker([o.LAT,o.LONG],{icon:t});return n?r.on("click",function(){e.$apply(function(){n(o)})}):r.bindPopup(e.buildLocationDetails(o)),r},e.buildLocationMarkers=function(o,t,n,r){if(o){var a=o.filter(function(o){return e.shouldDisplayLocationMarker(o,n)});angular.forEach(a,function(o){var n=L.icon({iconUrl:e.getLocationIcon(o),iconSize:[60,60],iconAnchor:[30,30]}),a=e.buildLocationMarker(o,n,r);t.push(a)})}},e.shouldDisplayMarker=function(e,o){return"Water"==e&&o.showWater||"Shelter"==e&&o.showShelter||"Food"==e&&o.showFood||"Clothing"==e&&o.showClothing||"Evacuation"==e&&o.showEvacuation||"First Aid"==e&&o.showMedical||"Medicine"==e&&o.showMedicine},e.shouldDisplayLocationMarker=function(o,t){for(var n=o.ResourceLocationInventories,r=0;r<n.length;r++)if(e.shouldDisplayMarker(n[r].ResourceType.Description,t))return!0;return!1},e.loadEvents(),e.$on("$locationChangeSuccess",function(o,t,n){var r=n.replace("/#/","/"),a=r.split("/"),s="";for(i=3;i<a.length;i++)s+="/",s+=a[i];e.previousPath=s}),e.redirectToLogin=function(){o.path("/login")},e.redirectToLogout=function(){e.currentUser=!1,sessionStorage.removeItem("user");var n=t({method:"POST",url:"/auth/logout",async:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"}});n.then(function(e){},function(e){alert("Logout Error - "+e)}),o.path("#")},e.resources=[{id:1,eventID:1,resourceType:"First Aid",lat:23.718,"long":90.355,provider:"NGO #1",message:""},{id:2,eventID:1,resourceType:"First Aid",lat:23.719,"long":90.374,provider:"NGO #2",message:""},{id:3,eventID:1,resourceType:"First Aid",lat:23.765,"long":90.398,provider:"NGO #3",message:""},{id:4,eventID:1,resourceType:"Water",lat:23.767,"long":90.41,provider:"NGO #4",message:""},{id:5,eventID:1,resourceType:"Evacuation Site",lat:23.73,"long":90.365,provider:"",message:"No more than 1 bag per person.  Only bring what you can carry."},{id:6,eventID:1,resourceType:"Evacuation Site",lat:23.75,"long":90.43,provider:"",message:"No more than 1 bag per person.  Only bring what you can carry."}]}]),angular.module("helpNow").controller("TeamInviteCtrl",["$scope","$resource","$routeParams","Invitation","$location","$uibModal",function(e,o,t,n,r,a){e.newInvite=new n,e.newInvite.OrganizationID=e.currentOrg.OrganizationID,console.log("$scope.currentOrg.OrganizationID"+e.currentOrg.OrganizationID),e.sendInvite=function(o){n.save(o),e.confirmEmail(o)},e.confirmEmail=function(o){e.modalInstance=a.open({templateUrl:"/manage/team-invite-modal-confirm.html",controller:function(e){this.invitation=o,e.confirm=function(){r.path("/manage")}},controllerAs:"model"})},e.go=function(e){r.path(e)}}]),angular.module("helpNow").directive("filters",function(){return{scope:{togglefunc:"=",classfunc:"="},templateUrl:"views/fragments/resource-filters.html"}}),angular.module("helpNow").directive("map",function(){return{link:function(e,o,t){var n=t.mapCenter.split(","),r=t.mapZoom,a="pk.eyJ1IjoiZGlnaXRhbGdsb2JlIiwiYSI6ImNpZjc5N3NiMTA5OXlzb2x6c3FyZHQ3cTUifQ.88yZYJc78Z2MAnkX2fOjuw",i='Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery � <a href="http://mapbox.com">Mapbox</a>',s="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ",c=(L.tileLayer(s,{id:"mapbox.light",attribution:i}),L.tileLayer(s,{id:"mapbox.streets",attribution:i}),L.esri.tiledMapLayer({url:"https://services.digitalglobe.com/earthservice/gis/0688362c-8f94-4016-95c3-172c2ab72023/rest/services/DigitalGlobe:ImageryTileService/MapServer",attribution:"DigitalGlobe Basemap, 2015"})),u=(L.tileLayer.wms("https://services.digitalglobe.com/mapservice/wmsaccess?connectid=0688362c-8f94-4016-95c3-172c2ab72023",{layers:"DigitalGlobe:Imagery",format:"image/png",transparent:!0,attribution:"DigitalGlobe 2015"}),L.esri.tiledMapLayer({url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",attribution:"Esri 2015"}),new L.tileLayer("https://{s}.tiles.mapbox.com/v4/digitalglobe.n6ngnadl/{z}/{x}/{y}.png?access_token="+a,{minZoom:2,maxZoom:19,attribution:'(c) <a href="http://microsites.digitalglobe.com/interactive/basemap_vivid/">DigitalGlobe</a>'}),new L.tileLayer("https://{s}.tiles.mapbox.com/v4/mapbox.streets/{z}/{x}/{y}.png?access_token="+a,{minZoom:2,maxZoom:19,attribution:"(c) OpenStreetMap , (c) Mapbox"}),new L.tileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:i,noWrap:!0,minZoom:2,maxZoom:18})),l=L.tileLayer("https://{s}.tiles.mapbox.com/v4/digitalglobe.n6nhclo2/{z}/{x}/{y}.png?access_token="+a,{minZoom:2,maxZoom:19,attribution:'(c) <a href="http://microsites.digitalglobe.com/interactive/basemap_vivid/">DigitalGlobe</a> , (c) OpenStreetMap, (c) Mapbox'}),d=new L.map("map",{layers:[l],maxBounds:[[-90,-180],[90,180]]}).setView(n,r);L.control.scale().addTo(d),d.attributionControl.setPrefix("");var g={"Base Open Street Maps":u,"DigitalGlobe Basemap +Vivid with Streets":l,"DigitalGlobe Basemap: REST":c};L.control.layers(g,null,{collapsed:!0}).addTo(d),d.addControl(new L.Control.Search({url:"http://nominatim.openstreetmap.org/search?format=json&q={s}",jsonpParam:"json_callback",propertyName:"display_name",propertyLoc:["lat","lon"],circleLocation:!1,markerLocation:!1,autoType:!1,autoCollapse:!0,minLength:2,zoom:13})),e.initMap&&e.initMap(d)}}}),angular.module("helpNow").factory("Account",function(e){return e("api/account/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("DemoService",["$q",function(e){var o=new Worker("doWork.js"),t=e.defer();return o.addEventListener("message",function(e){console.log("Worker said: ",e.data),t.resolve(e.data)},!1),{doWork:function(n){return t=e.defer(),o.postMessage(n),t.promise}}}]),angular.module("helpNow").factory("Event",function(e){return e("api/event/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("EventLocation",function(e){return e("api/eventlocation/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("Invitation",function(e){return e("api/inviterequest/:inviteid",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("Organization",function(e){return e("/api/organization/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("Regulation",function(e){return e("api/organizationregulation/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("ResourceLocation",function(e){return e("api/resourcelocation/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("ResourceLocationInventory",function(e){return e("api/resourcelocationinventory/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("ResourceLocationTransport",function(e){return e("api/resourcelocationtransport/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("ResourceLocationType",function(e){return e("api/resourcelocationtype/:id",null,{update:{method:"PUT"}})}),angular.module("helpNow").factory("ResourceRequest",function(e){return e("api/resourcerequest/:id",null,{update:{method:"PUT"}})});